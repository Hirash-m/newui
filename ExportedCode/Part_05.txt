===== FILE: src\app\services\utilities\toast.service.spec.ts =====
import { TestBed } from '@angular/core/testing';

import { ToastService } from './toast.service';

describe('ToastService', () => {
  let service: ToastService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(ToastService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


===== FILE: src\app\services\utilities\toast.service.ts =====
// src/app/services/utilities/toast.service.ts

import { Injectable, signal } from '@angular/core';
import { HttpErrorResponse } from '@angular/common/http';
import { ApiResult } from 'src/app/dto/api-result';

export type ToastType = 'success' | 'error' | 'warning' | 'info';

export interface ToastData {
  id: number;
  title: string;
  message: string;
  type: ToastType;
  duration?: number;
}

@Injectable({ providedIn: 'root' })
export class ToastService {
  private counter = 0;
  toasts = signal<ToastData[]>([]);

  // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶
  private defaults = {
    success: { title: 'Ø¹Ù…Ù„ÛŒØ§Øª Ù…ÙˆÙÙ‚', duration: 4000 },
    error: { title: 'Ø®Ø·Ø§', duration: 6000 },
    warning: { title: 'Ø§Ø®Ø·Ø§Ø±', duration: 5000 },
    info: { title: 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª', duration: 4000 },
  };

  // Ù…ØªØ¯ Ø§ØµÙ„ÛŒ Ù†Ù…Ø§ÛŒØ´ Toast
  private show(type: ToastType, message: string, title?: string, duration?: number): void {
    const id = this.counter++;
    const config = this.defaults[type];

    const toast: ToastData = {
      id,
      type,
      title: title ?? config.title,
      message,
      duration: duration ?? config.duration,
    };

    this.toasts.update(list => [...list, toast]);
    setTimeout(() => this.remove(id), toast.duration);
  }

  // Ù…ØªØ¯Ù‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ
  success(message: string, title?: string): void {
    this.show('success', message, title);
  }

  error(message: string, title?: string): void {
    this.show('error', message, title);
  }

  warning(message: string, title?: string): void {
    this.show('warning', message, title);
  }

  info(message: string, title?: string): void {
    this.show('info', message, title);
  }

  remove(id: number): void {
    this.toasts.update(list => list.filter(t => t.id !== id));
  }
  removeToast(id: number): void {
    this.toasts.update(list => list.filter(t => t.id !== id));
  }
  // --- ÙÙ‚Ø· Ù¾ÛŒØ§Ù… Ø§Ø² ApiResult â€” Ø¨Ø¯ÙˆÙ† fallback Ù…Ø­Ù„ÛŒ ---
  handleApiResponse<T>(result: ApiResult<T>): void {
    if (result.isSucceeded) {
      if (result.message) {
        this.success(result.message);
      }
      // Ø§Ú¯Ø± message Ù†Ø¨ÙˆØ¯ â†’ Ù‡ÛŒÚ† ØªÙˆØ³ØªÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯
    } else {
      this.handleApiError(result);
    }
  }
  

  // --- Ù‡Ù†Ø¯Ù„ Ú©Ø±Ø¯Ù† Ø®Ø·Ø§Ù‡Ø§ÛŒ ApiResult Ø¨Ø§ Ú†Ú© statusCode Ø§ÛŒÙ…Ù† ---
  private handleApiError(result: ApiResult): void {
    const errors = result.errors ?? [];
    const message = errors.length > 0 ? errors[0] : result.message ?? 'Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯.';

    const status = result.statusCode;

    if (status === 401) {
      this.warning(message, 'Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª');
    } else if (status === 403) {
      this.warning(message, 'Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ù…Ù†ÙˆØ¹');
    } else if (status != null && status >= 400 && status < 500) {
      this.error(message, 'Ø®Ø·Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ');
    } else {
      this.error(message); // 500 ÛŒØ§ Ø¨Ø¯ÙˆÙ† statusCode
    }
  }

  // --- ÙÙ‚Ø· Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø®Ø§Ù… HTTP (Ø¨Ø¯ÙˆÙ† ApiResult) ---
  handleHttpError(error: HttpErrorResponse): void {
    let message = 'Ø®Ø·Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±';

    if (error.error instanceof ErrorEvent) {
      // Ø®Ø·Ø§ÛŒ Ú©Ù„Ø§ÛŒÙ†Øª
      message = `Ø®Ø·Ø§: ${error.error.message}`;
    } else {
      // Ø®Ø·Ø§ÛŒ Ø³Ø±ÙˆØ±
      const status = error.status;
      const body = error.error;

      if (status === 0) {
        message = 'Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø¨Ø±Ù‚Ø±Ø§Ø± Ù†ÛŒØ³Øª.';
      } else if (status === 500) {
        message = 'Ø®Ø·Ø§ÛŒ Ø¯Ø§Ø®Ù„ÛŒ Ø³Ø±ÙˆØ±.';
      } else if (status === 404) {
        message = 'Ù…Ù†Ø¨Ø¹ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.';
      } else if (body && typeof body === 'object' && 'message' in body) {
        message = (body as any).message;
      } else if (typeof body === 'string') {
        message = body;
      }
    }

    this.error(message);
  
  
  }

  
}

===== FILE: src\app\views\base\login\loginForm\login\login.component.html =====
<div class="bg-light dark:bg-transparent min-vh-100 d-flex flex-row align-items-center">
  <c-container breakpoint="md">
    <c-row class="justify-content-center">
      <c-col lg="10" xl="8">
        <c-card-group>
          <c-card class="p-4">
            <c-card-body>
              <form cForm (ngSubmit)="onLogin()">
                <h1>ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…</h1>
                <p class="text-body-secondary">Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>

                <c-input-group class="mb-3">
                  <span cInputGroupText>
                    <svg cIcon name="cilUser"></svg>
                  </span>
                  <input
                    type="text"
                    autoComplete="username"
                    cFormControl
                    placeholder="Ù†Ø§Ù…â€ŒÚ©Ø§Ø±Ø¨Ø±ÛŒ"
                    [(ngModel)]="username"
                    name="username"
                    required
                  />
                </c-input-group>

                <c-input-group class="mb-4">
                  <span cInputGroupText>
                    <svg cIcon name="cilLockLocked"></svg>
                  </span>
                  <input
                    type="password"
                    autoComplete="current-password"
                    cFormControl
                    placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±"
                    [(ngModel)]="password"
                    name="password"
                    required
                  />
                </c-input-group>

                <c-row>
                  <c-col xs="12" class="text-center">
                    <button
                      cButton
                      class="px-4"
                      color="primary"
                      type="submit"
                      [disabled]="loading"
                    >
                      {{ loading ? 'Ø¯Ø± Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯...' : 'ÙˆØ±ÙˆØ¯' }}
                    </button>
                  </c-col>
                </c-row>

                <!--
                <c-row class="mt-3">
                  <c-col class="text-right" xs="6">
                    <button cButton class="px-0" color="link" type="button">
                      ÙØ±Ø§Ù…ÙˆØ´ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±ØŸ
                    </button>
                  </c-col>
                </c-row>
                -->
              </form>
            </c-card-body>
          </c-card>

          <!--
          <c-card [ngStyle]="{'minWidth.%': 44}" class="text-white bg-primary py-5">
            <c-card-body class="text-center">
              <div>
                <h2>Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</h2>
                <p>
                  Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø³Ø§Ù…Ø§Ù†Ù‡ØŒ ÛŒÚ© Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯.
                </p>
                <button
                  [active]="true"
                  cButton
                  class="mt-3"
                  color="primary"
                  routerLink="/register"
                >
                  Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯
                </button>
              </div>
            </c-card-body>
          </c-card>
          -->
        </c-card-group>
      </c-col>
    </c-row>
  </c-container>
</div>


===== FILE: src\app\views\base\login\loginForm\login\login.component.scss =====


===== FILE: src\app\views\base\login\loginForm\login\login.component.spec.ts =====
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { ButtonModule, CardModule, FormModule, GridModule } from '@coreui/angular';
import { LoginComponent } from './login.component';
import { IconModule } from '@coreui/icons-angular';
import { IconSetService } from '@coreui/icons-angular';
import { iconSubset } from 'src/app/icons/icon-subset';


describe('LoginComponent', () => {
  let component: LoginComponent;
  let fixture: ComponentFixture<LoginComponent>;
  let iconSetService: IconSetService;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
    imports: [FormModule, CardModule, GridModule, ButtonModule, IconModule, LoginComponent],
    providers: [IconSetService]
})
    .compileComponents();
  });

  beforeEach(() => {
    iconSetService = TestBed.inject(IconSetService);
    iconSetService.icons = { ...iconSubset };

    fixture = TestBed.createComponent(LoginComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});


===== FILE: src\app\views\base\login\loginForm\login\login.component.ts =====
import { Component } from '@angular/core';
import { NgStyle, NgIf } from '@angular/common';
import { Router } from '@angular/router';
import { IconDirective } from '@coreui/icons-angular';
import {
  ContainerComponent,
  RowComponent,
  ColComponent,
  CardGroupComponent,
  TextColorDirective,
  CardComponent,
  CardBodyComponent,
  FormDirective,
  InputGroupComponent,
  InputGroupTextDirective,
  FormControlDirective,
  ButtonDirective
} from '@coreui/angular';
import { FormsModule } from '@angular/forms';
import { AuthService } from '../../../../../services/auth/login/auth.service';
import { ToastService } from '../../../../../services/utilities/toast.service';
import { ApiResult } from 'src/app/dto/api-result';

@Component({
  selector: 'app-login',
  templateUrl: './login.component.html',
  styleUrls: ['./login.component.scss'],
  standalone: true,
  imports: [
    ContainerComponent,
    RowComponent,
    ColComponent,
    CardGroupComponent,
    TextColorDirective,
    CardComponent,
    CardBodyComponent,
    FormDirective,
    InputGroupComponent,
    InputGroupTextDirective,
    IconDirective,
    FormControlDirective,
    ButtonDirective,
    FormsModule,

  ]
})
export class LoginComponent {
  username: string = '';
  password: string = '';
  loading: boolean = false;

  constructor(
    private authService: AuthService,
    private toast: ToastService,
    private router: Router
  ) {}
  onLogin() {
    if (!this.username || !this.password) {
      this.toast.error('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù…â€ŒÚ©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
      return;
    }
  
    this.loading = true;
  
    this.authService.login(this.username, this.password).subscribe({
      next: (res: ApiResult<any>) => {
        this.loading = false;
  
        if (res.isSucceeded && res.data?.token) {
          this.toast.success('ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯');
          this.router.navigate(['/dashboard']);
          
        } else {
          // Ø§ÛŒÙ† Ù‚Ø³Ù…Øª Ø­ÛŒØ§ØªÛŒ Ø§Ø³Øª!
          const errorMsg = res. message || res.errors?.join(', ') || 'ÙˆØ±ÙˆØ¯ Ù†Ø§Ù…ÙˆÙÙ‚';
          this.toast.error(errorMsg);
        }
      },
      error: (err) => {
        this.loading = false;
        this.toast.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
        console.error('HTTP Error:', err);
      }
    });
  }
}


===== FILE: src\app\views\base\userManage\user\user.component.html =====


<!-- Ø¯Ú©Ù…Ù‡â€ŒÛŒ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† ÙØ±Ù… Ù¾Ø§Ù¾â€ŒØ¢Ù¾ -->
<button cButton color="primary" (click)="showModal = true">âž• Ø§ÛŒØ¬Ø§Ø¯ </button>
<button
  cButton
  color="danger"
  [disabled]="selectedIds.length === 0"
  (click)="showDeleteConfirm = true"
>
ðŸ—‘ Ø­Ø°Ù Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡â€ŒÙ‡Ø§ ({{ selectedIds.length }})
</button>


<!-- Table -->

<table cTable>
  <thead>
    <tr>
      <th>Ø§Ù†ØªØ®Ø§Ø¨</th>
      <th>Ø´Ù†Ø§Ø³Ù‡</th>
      <th>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</th>
      <th>Ø§ÛŒÙ…ÛŒÙ„</th>
      <th>Ú©Ù„Ù…Ù‡ Ø¹Ø¨ÙˆØ±</th>
      <th>Ù†Ø§Ù… Ú©Ø§Ù…Ù„ </th>
      <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
    </tr>
  </thead>
  <tbody>
     <tr *ngFor="let row of _objectsView">
      <td> <input type="checkbox" [checked]="isSelected(row.id)" (change)="toggleSelection(row.id)" /> </td>
      <td>{{row.id}}</td>
      <td>{{row.username}}</td>
      <td>   {{row.email}}   </td>
      <td>   {{row.Password}}   </td>
      <td>   {{row.fullName}}   </td>
         <td>
          <button class="btn btn-sm btn-warning me-1"    (click)="onEdit(row.id)" > âœ ÙˆÛŒØ±Ø§ÛŒØ´</button>
        </td>
    </tr>
  </tbody>
</table>



<!--nodata banner -->

<div *ngIf="_objectsView.length === 0" class="alert alert-info text-center">
  â• Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.
</div>



<div class="d-flex justify-content-between align-items-center mt-3">

  <!-- Ø®ÙˆØ¯ pagination -->
  <c-pagination aria-label="Page navigation example">
    <li cPageItem *ngIf="_baseResponse.pageNumber! > 3">
      <button cPageLink aria-label="First" (click)="changePage(1)">
        <span aria-hidden="true">&laquo;</span>
      </button>
    </li>

    <li cPageItem *ngIf="_baseResponse.pageNumber! > 1">
      <button cPageLink aria-label="Previous" (click)="changePage(_baseResponse.pageNumber! - 1)">
        <span aria-hidden="true">&lt;</span>
      </button>
    </li>

    <li cPageItem *ngIf="_baseResponse.pageNumber! > 2">
      <button cPageLink (click)="changePage(_baseResponse.pageNumber! - 2)">
        {{ _baseResponse.pageNumber!- 2 }}
      </button>
    </li>

    <li cPageItem *ngIf="_baseResponse.pageNumber! > 1">
      <button cPageLink (click)="changePage(_baseResponse.pageNumber! - 1)">
        {{ _baseResponse.pageNumber! - 1 }}
      </button>
    </li>

    <li cPageItem>
      <button cPageLink class="active" disabled>
        {{ _baseResponse.pageNumber }}
      </button>
    </li>

    <li cPageItem *ngIf="_baseResponse.totalPages! > _baseResponse.pageNumber!">
      <button cPageLink (click)="changePage(_baseResponse.pageNumber! + 1)">
        {{ _baseResponse.pageNumber! + 1 }}
      </button>
    </li>

    <li cPageItem *ngIf="_baseResponse.totalPages! > _baseResponse.pageNumber! + 1">
      <button cPageLink (click)="changePage(_baseResponse.pageNumber! + 2)">
        {{ _baseResponse.pageNumber! + 2 }}
      </button>
    </li>

    <li cPageItem *ngIf="_baseResponse.totalPages! > _baseResponse.pageNumber!">
      <button cPageLink aria-label="Next" (click)="changePage(_baseResponse.pageNumber! + 1)">
        <span aria-hidden="true">&gt;</span>
      </button>
    </li>

    <li cPageItem *ngIf="_baseResponse.totalPages! > _baseResponse.pageNumber! + 2">
      <button cPageLink aria-label="Last" (click)="changePage(_baseResponse.totalPages!)">
        <span aria-hidden="true">&raquo;</span>
      </button>
    </li>
  </c-pagination>

  <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ú©ÙˆØ±Ø¯ -->
  <div class="text-muted">
    <strong>{{_baseResponse.totalRecords}}</strong> Ø±Ú©ÙˆØ±Ø¯ Ø¯Ø± <strong>{{_baseResponse.totalPages}}</strong> ØµÙØ­Ù‡
  </div>

</div>






<!-- Ù…ÙˆØ¯Ø§Ù„ ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„ -->
<c-modal [(visible)]="showModal" size="lg" backdrop="static">
  <c-modal-header>
    <h5 class="modal-title">{{ editMode ? 'ÙˆÛŒØ±Ø§ÛŒØ´ ' : 'Ø§ÙØ²ÙˆØ¯Ù†' }}</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="showModal = false"></button>
  </c-modal-header>

  <c-modal-body>
    <!-- ÙØ±Ù… Ø¯Ø§Ø®Ù„ Ù…ÙˆØ¯Ø§Ù„ -->
    <form [formGroup]="ObjectForm"  (ngSubmit)="onSubmit1()" class="needs-validation" novalidate cForm cRow>

      <!-- Ù†Ø§Ù… -->
      <c-col [md]="6">
        <label cLabel for="username">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ </label>
        <input cFormControl id="username" name="username" type="text" required formControlName="username">
        <c-form-feedback [valid]="false">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</c-form-feedback>
      </c-col>

      <c-col [md]="6">
        <label cLabel for="email">Ø§ÛŒÙ…ÛŒÙ„ </label>
        <input cFormControl id="email" name="email" type="email" required formControlName="email">
        <c-form-feedback [valid]="false">Ø§ÛŒÙ…ÛŒÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</c-form-feedback>
      </c-col>
      <c-col [md]="6">
        <label cLabel for="fullName">Ù†Ø§Ù… Ú©Ø§Ù…Ù„ </label>
        <input cFormControl id="fullName" name="fullName" type="text" required formControlName="fullName">
        <c-form-feedback [valid]="false">Ø§ÛŒÙ…ÛŒÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</c-form-feedback>
      </c-col>

      <c-col [md]="6">
        <label cLabel for="Password">Ú©Ù„Ù…Ù‡ Ø¹Ø¨ÙˆØ± </label>
        <input cFormControl id="Password" name="Password" type="Password"  formControlName="Password">
        <c-form-feedback [valid]="false">Ú©Ù„Ù…Ù‡ Ø¹Ø¨ÙˆØ±  Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</c-form-feedback>
      </c-col>


      <!-- Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ± -->
      <div class="mb-3">
        <label cFormLabel>ØªØµÙˆÛŒØ± Ù¾Ø±ÙˆÙØ§ÛŒÙ„</label>
        <input
          type="file"
          cFormControl
          accept="image/*"
          (change)="onFileSelected($event)"
          class="form-control"
        >
        <small class="text-muted">ÙÙ‚Ø· ØªØµØ§ÙˆÛŒØ± (JPG, PNG)</small>
      </div>
 
<!-- Ø¨Ø®Ø´ Ù†Ù‚Ø´â€ŒÙ‡Ø§ -->
<c-col [md]="12">
  <label cLabel>Ù†Ù‚Ø´â€ŒÙ‡Ø§</label>
  <div *ngFor="let role of roles" class="form-check">
    <input
      type="checkbox"
      class="form-check-input"
      [id]="'role-' + role.id"
      [value]="role.id"
      [checked]="ObjectForm.get('roleIds')?.value.includes(role.id)"
      (change)="toggleRole($event, role.id)"
    >
    <label class="form-check-label" [for]="'role-' + role.id">
      {{ role.name }}
    </label>
  </div>
</c-col>




    </form>
  </c-modal-body>

  <c-modal-footer>
    <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ùˆ Ø¨Ø³ØªÙ† -->
    <button cButton color="secondary" (click)="closeModal()" >Ø¨Ø³ØªÙ†</button>
    <button cButton color="primary" type="submit" (click)="onSubmit1()"  [disabled]="!ObjectForm.valid "  >Ø°Ø®ÛŒØ±Ù‡</button>
  </c-modal-footer>
</c-modal>



<c-modal [(visible)]="showDeleteConfirm" col="6" backdrop="static">
  <c-modal-header>
    <h5 class="modal-title">â— ØªØ£ÛŒÛŒØ¯ Ø­Ø°Ù</h5>
    <button type="button" class="btn-close" (click)="showDeleteConfirm = false" aria-label="Close"></button>
  </c-modal-header>

  <c-modal-body>
    <p>Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ <strong>{{ selectedIds.length }}</strong> Ù…Ø­ØµÙˆÙ„ Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ</p>
  </c-modal-body>

  <c-modal-footer>
    <button cButton color="secondary" (click)="showDeleteConfirm = false">Ø§Ù†ØµØ±Ø§Ù</button>
    <button cButton color="danger" (click)="deleteSelectedRecords()">ØªØ£ÛŒÛŒØ¯ Ø­Ø°Ù</button>
  </c-modal-footer>
</c-modal>


===== FILE: src\app\views\base\userManage\user\user.component.scss =====


===== FILE: src\app\views\base\userManage\user\user.component.spec.ts =====
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { UserComponent } from './user.component';

describe('UserComponent', () => {
  let component: UserComponent;
  let fixture: ComponentFixture<UserComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [UserComponent]
    })
    .compileComponents();

    fixture = TestBed.createComponent(UserComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});


===== FILE: src\app\views\base\userManage\user\user.component.ts =====
import { CommonModule } from '@angular/common';
import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, FormsModule, ReactiveFormsModule, Validators } from '@angular/forms';
import { ButtonDirective, ColComponent, FormDirective, FormFeedbackComponent, FormLabelDirective, ModalModule, PageItemDirective, PageLinkDirective, PaginationComponent, RowDirective, TableDirective } from '@coreui/angular';
import { PermissionDto, RoleDto, UserCreateFormData, UserDto } from 'src/app/dto/base/UserDto';
import { ApiResult, createApiResult } from 'src/app/dto/api-result'; // ØªØºÛŒÛŒØ± Ø§Ø² baseResponse
import { ListRequest } from 'src/app/dto/ListRequestDto';
import { UserManageService } from 'src/app/services/base/userManage/user-manage.service';
import { ToastService } from 'src/app/services/utilities/toast.service';

@Component({
  selector: 'app-user',
  standalone: true,
  imports: [
    CommonModule, TableDirective, PaginationComponent, PageItemDirective, PageLinkDirective,
    ButtonDirective, ColComponent, FormDirective, FormFeedbackComponent,
    FormLabelDirective, RowDirective, ModalModule,
    FormsModule, ReactiveFormsModule,
  ],
  templateUrl: './user.component.html',
  styleUrl: './user.component.scss'
})
export class UserComponent implements OnInit {

  // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ±Ù… Ø§ÛŒØ¬Ø§Ø¯
  roles: RoleDto[] = [];
  permissions: PermissionDto[] = [];

  // Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
  _request = new ListRequest();
  _objectsView: UserDto[] = [];
  _baseResponse: ApiResult<UserDto[]> = createApiResult<UserDto[]>();

  // ÙØ±Ù…
  ObjectForm!: FormGroup;
  showModal = false;

  // ÙˆÛŒØ±Ø§ÛŒØ´
  editMode = false;
  editingId: number | null = null;

  // Ø­Ø°Ù Ú¯Ø±ÙˆÙ‡ÛŒ
  selectedIds: number[] = [];
  showDeleteConfirm = false;

  constructor(
    private fb: FormBuilder,
    private ObjectService: UserManageService,
    private toastService: ToastService
  ) {}

  ngOnInit(): void {
    this.initForm();
    this.loadDataTable();
    this.loadCreateFormData();
  }

  // ---------------------------
  // ÙØ±Ù…
  // ---------------------------
  initForm() {
    this.ObjectForm = this.fb.group({
      id: [null],
      username: ['', Validators.required],
      email: ['', [Validators.required, Validators.email]],
      Password: ['', this.editMode ? [] : Validators.required],
      fullName: ['', Validators.required],
      roleIds: [[]],
      profilePicture: [null]  
    });
  }


  // Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„
onFileSelected(event: Event): void {
  const input = event.target as HTMLInputElement;
  if (input.files && input.files[0]) {
    const file = input.files[0];
    this.ObjectForm.patchValue({ profilePicture: file });
    this.ObjectForm.get('profilePicture')?.updateValueAndValidity();
  }
}

  // ---------------------------
  // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
  // ---------------------------
  loadDataTable(): void {
    this._request.pageSize = 5;
    this.ObjectService.getRecords(this._request).subscribe({
      next: (res: ApiResult<UserDto[]>) => {
        if (res.isSucceeded) {
          this._baseResponse = res;
          this._objectsView = res.data || [];
        } else {
          this.toastService.error(res.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†');
        }
      },
      error: (err) => {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†:', err);
        this.toastService.error('Ø®Ø·Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
      }
    });
  }

  // ---------------------------
  // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ù‚Ø´â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ ÙØ±Ù… Ø§ÛŒØ¬Ø§Ø¯
  // ---------------------------
  loadCreateFormData(): void {
    this.ObjectService.getCreateForm().subscribe({
      next: (res: ApiResult<UserCreateFormData>) => {
        if (res.isSucceeded && res.data) {
          // Ø­Ø§Ù„Ø§ res.data ÛŒÚ© Ø´ÛŒØ¡ ØªÚ© Ø§Ø³Øª: { roles: [...] }
          const formData = res.data as UserCreateFormData;
  
          this.roles = formData.roles ?? [];
          this.permissions = [];
  
          console.log('ÙØ±Ù… Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯:', formData);
        } else {
          this.toastService.error(res.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ÙØ±Ù… Ø§ÛŒØ¬Ø§Ø¯');
        }
      },
      error: (err) => {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ÙØ±Ù… Ø§ÛŒØ¬Ø§Ø¯:', err);
        this.toastService.error('Ø®Ø·Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
      }
    });
  }

  // ---------------------------
  // Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù‚Ø´
  // ---------------------------
  toggleRole(event: Event, roleId: number): void {
    const input = event.target as HTMLInputElement;
    const roleIds = this.ObjectForm.get('roleIds')?.value || [];

    if (input.checked && !roleIds.includes(roleId)) {
      roleIds.push(roleId);
    } else if (!input.checked) {
      const index = roleIds.indexOf(roleId);
      if (index > -1) roleIds.splice(index, 1);
    }

    this.ObjectForm.get('roleIds')?.setValue(roleIds);
  }

  // ---------------------------
  // Ø§ÛŒØ¬Ø§Ø¯ / ÙˆÛŒØ±Ø§ÛŒØ´
  // ---------------------------
  onSubmit1() {
    if (this.ObjectForm.valid) {
      const formValue = this.ObjectForm.value;
      const data: UserDto = {
        ...formValue,
        profilePicture: formValue.profilePicture // File object
      };
  
      const request$ = this.editMode && this.editingId != null
        ? this.ObjectService.updateRecord(data)
        : this.ObjectService.insertRecord(data);
  
      request$.subscribe({
        next: (res: ApiResult<any>) => {
          if (res.isSucceeded) {
            this.afterSubmit();
            this.toastService.success(
              this.editMode ? 'Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯' : 'Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯'
            );
          } else {
            this.toastService.error(res.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø¹Ù…Ù„ÛŒØ§Øª');
          }
        },
        error: (err) => {
          console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ú©Ø§Ø±Ø¨Ø±:', err);
          this.toastService.error('Ø®Ø·Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
        }
      });
    }
  }

  afterSubmit() {
    this.loadDataTable();
    this.closeModal();
  }

  closeModal() {
    this.showModal = false;
    this.ObjectForm.reset({
      id: null,
      username: '',
      fullName: '',
      email: '',
      Password: '',
      profilePicture: null,
      roleIds: []
    });
    this.editMode = false;
    this.editingId = null;
    this.initForm(); // Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ ÙØ±Ù… Ø¨Ø§ ÙˆÙ„ÛŒØ¯Ø§ØªÙˆØ±Ù‡Ø§ÛŒ Ø¯Ø±Ø³Øª
  }

  // ---------------------------
  // ÙˆÛŒØ±Ø§ÛŒØ´
  // ---------------------------
  onEdit(id: number) {
    this.editMode = true;
    this.editingId = id;
  
    const passwordControl = this.ObjectForm.get('Password');
    passwordControl?.clearValidators();
    passwordControl?.updateValueAndValidity();
  
    this.ObjectService.getRecordById(id).subscribe({
      next: (res: ApiResult<UserDto>) => {
        if (res.isSucceeded && res.data) {
          const user = res.data;
          this.ObjectForm.patchValue({
            id: user.id,
            username: user.username,
            fullName: user.fullName,
            email: user.email,
            Password: '',
            roleIds: user.roleIds || [],
            profilePicture: null  // ÙØ§ÛŒÙ„ Ù‚Ø¨Ù„ÛŒ Ø­Ø°Ù Ù…ÛŒØ´Ù‡
          });
          this.showModal = true;
        } else {
          this.toastService.error('Ú©Ø§Ø±Ø¨Ø± Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯');
        }
      },
      error: () => {
        this.toastService.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±');
      }
    });
  }
  // ---------------------------
  // ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ
  // ---------------------------
  changePage(pageNumber: number) {
    this._request.pageNumber = pageNumber;
    this.loadDataTable();
  }

  // ---------------------------
  // Ø­Ø°Ù Ú¯Ø±ÙˆÙ‡ÛŒ
  // ---------------------------
  isSelected(id: number): boolean {
    return this.selectedIds.includes(id);
  }

  toggleSelection(id: number): void {
    const index = this.selectedIds.indexOf(id);
    if (index > -1) {
      this.selectedIds.splice(index, 1);
    } else {
      this.selectedIds.push(id);
    }
  }

  deleteSelectedRecords(): void {
    this.ObjectService.deleteRecords(this.selectedIds).subscribe({
      next: (res: ApiResult<any>) => {
        if (res.isSucceeded) {
          this.afterSubmit();
          this.selectedIds = [];
          this.toastService.success('Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ Ø­Ø°Ù Ø´Ø¯Ù†Ø¯');
        } else {
          this.toastService.error(res.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù');
        }
        this.showDeleteConfirm = false;
      },
      error: () => {
        this.toastService.error('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ú¯Ø±ÙˆÙ‡ÛŒ');
      }
    });
  }
}

===== FILE: src\app\views\base\routes.ts =====
import { Routes } from '@angular/router';

export const routes: Routes = [
  {
    path: '',
    data: {
      title: 'base'
    },
    children: [
      {
        path: '',
        redirectTo: 'coreui-icons',
        pathMatch: 'full'
      },
      {
        path: 'user',
        loadComponent: () => import('./userManage/user/user.component').then(m => m.UserComponent),
        data: {
          title: 'Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª '
        }
      },
      
    ]
  }
];


===== FILE: src\app\views\chat\chat\chat.component.html =====
<!-- src/app/views/chat/chat/chat.component.html -->
<c-row>
    <c-col md="4">
      <c-card class="h-100">
        <c-card-header class="d-flex justify-content-between align-items-center">
          <span>Ú†Øªâ€ŒÙ‡Ø§</span>
          <div>
            <c-badge color="danger" *ngIf="totalUnread > 0">{{ totalUnread }}</c-badge>
            <button cButton color="primary" size="sm" class="ms-2" (click)="showUserList = !showUserList">
              Ú†Øª Ø¬Ø¯ÛŒØ¯
            </button>
          </div>
        </c-card-header>
  
        <!-- Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø±Ø§ÛŒ Ú†Øª Ø¬Ø¯ÛŒØ¯ -->
        <div *ngIf="showUserList" class="p-3 border-bottom bg-light">
          <input 
            type="text" 
            class="form-control form-control-sm mb-2" 
            placeholder="Ø¬Ø³ØªØ¬Ùˆ..." 
            [(ngModel)]="searchTerm"
          >
          <div class="list-group list-group-flush" style="max-height: 200px; overflow-y: auto;">
            <a 
              *ngFor="let user of allUsers | filter:searchTerm:'name'" 
              (click)="startNewChat(user)" 
              class="list-group-item list-group-item-action py-2"
              style="cursor: pointer;"
            >
              <strong>{{ user.name || user.username }}</strong>
              <small class="text-muted d-block">{{ user.email }}</small>
            </a>
          </div>
        </div>
  
        <!-- Ù„ÛŒØ³Øª Ú†Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ -->
        <ul class="list-group list-group-flush">
          <li
            *ngFor="let user of chatList"
            (click)="selectUser(user)"
            [class.active]="selectedUser?.userId === user.userId"
            class="list-group-item d-flex justify-content-between align-items-center cursor-pointer"
          >
            <div class="d-flex align-items-center">
              <c-icon 
                [name]="user.isOnline ? 'cil-user-follow' : 'cil-user-unfollow'"
                [class.text-success]="user.isOnline"
                [class.text-secondary]="!user.isOnline"
              ></c-icon>
              <span class="mx-2">{{ user.userName }}</span>
            </div>
            <c-badge color="danger" *ngIf="user.unreadCount > 0">{{ user.unreadCount }}</c-badge>
          </li>
        </ul>
      </c-card>
    </c-col>
  
    <c-col md="8">
      <c-card class="h-100 d-flex flex-column" *ngIf="selectedUser; else noChat">
        <c-card-header>
          <strong>{{ selectedUser.userName }}</strong>
          <small class="text-muted d-block">
            {{ selectedUser.isOnline ? 'Ø¢Ù†Ù„Ø§ÛŒÙ†' : 'Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø²Ø¯ÛŒØ¯: ' + (selectedUser.lastSeen | date:'short') }}
          </small>
        </c-card-header>
  
        <c-card-body #chatBody class="flex-grow-1 overflow-auto p-3">
          <div *ngFor="let msg of messages" class="mb-3" [class.text-end]="msg.isMine">
            <div [class]="msg.isMine ? 'd-inline-block bg-primary text-white p-2 rounded' : 'd-inline-block bg-light p-2 rounded'">
              <p class="mb-1">{{ msg.content }}</p>
              <img *ngIf="msg.type === 'Image'" [src]="msg.fileUrl" class="img-fluid rounded" style="max-width: 200px;">
              <a *ngIf="msg.type === 'File'" [href]="msg.fileUrl" download class="text-decoration-underline">
                Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„
              </a>
              <small class="d-block opacity-75">
                {{ msg.sentAt | date:'short' }}
                <span *ngIf="msg.seenAt"> (Ø®ÙˆØ§Ù†Ø¯Ù‡â€ŒØ´Ø¯Ù‡)</span>
              </small>
            </div>
          </div>
        </c-card-body>
  
        <c-card-footer>
          <div class="d-flex align-items-center gap-2">
            <input 
              type="text" 
              [(ngModel)]="newMessage" 
              placeholder="Ù¾ÛŒØ§Ù…..." 
              class="form-control" 
              (keydown.enter)="sendMessage()"
            >
            <input 
              type="file" 
              (change)="onFileSelected($event)" 
              class="form-control" 
              style="width: auto;"
            >
            <button cButton color="primary" (click)="sendMessage()">Ø§Ø±Ø³Ø§Ù„</button>
          </div>
        </c-card-footer>
      </c-card>
  
      <ng-template #noChat>
        <div class="text-center text-muted mt-5 p-5">
          <h5>Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</h5>
          <p class="text-muted">Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ú†ØªØŒ Ø±ÙˆÛŒ "Ú†Øª Ø¬Ø¯ÛŒØ¯" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</p>
        </div>
      </ng-template>
    </c-col>
  </c-row>

===== FILE: src\app\views\chat\chat\chat.component.scss =====



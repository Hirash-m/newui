===== FILE: src\app\views\shop\product\product.component.ts =====
// ---------------------------
// Import Dependencies
// ---------------------------
import { CommonModule } from '@angular/common';
import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, FormsModule, ReactiveFormsModule, Validators } from '@angular/forms';

// CoreUI components & directives
import {
  ButtonDirective, ColComponent,
  FormDirective, FormFeedbackComponent, FormLabelDirective, ModalModule,
  PageItemDirective, PageLinkDirective,
  PaginationComponent, RowDirective, TableDirective,
  AccordionButtonDirective, AccordionComponent, AccordionItemComponent, TemplateIdDirective
} from '@coreui/angular';

// DTOs & Services
import { ApiResult, createApiResult } from 'src/app/dto/api-result'; // ØªØºÛŒÛŒØ± Ø§Ø² baseResponse
import { ListRequest } from 'src/app/dto/ListRequestDto';
import { ProductCreateDto, ProductViewDto } from 'src/app/dto/shop/ProductDto';
import { ProductService } from 'src/app/services/shop/product/product.service';
import { ToastService } from 'src/app/services/utilities/toast.service';

@Component({
  selector: 'app-product',
  templateUrl: './product.component.html',
  styleUrl: './product.component.scss',
  imports: [
    CommonModule, TableDirective, PaginationComponent, PageItemDirective, PageLinkDirective,
    ButtonDirective, ColComponent, FormDirective, FormFeedbackComponent,
    FormLabelDirective, RowDirective, FormsModule, ReactiveFormsModule, ModalModule,
    AccordionComponent, AccordionItemComponent, TemplateIdDirective, AccordionButtonDirective
  ],
  standalone: true
})
export class ProductComponent implements OnInit {

  // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù„ÛŒØ³Øª
  _request = new ListRequest();
  _productsView: ProductViewDto[] = [];
  _baseResponse: ApiResult<ProductViewDto[]> = createApiResult<ProductViewDto[]>();

  // ÙØ±Ù…
  showModal = false;
  productForm!: FormGroup;

  // ÙˆÛŒØ±Ø§ÛŒØ´
  editMode = false;
  editingProductId: number | null = null;

  // Ø­Ø°Ù Ú¯Ø±ÙˆÙ‡ÛŒ
  selectedProductIds: number[] = [];
  showDeleteConfirm = false;

  // Ø¬Ø³ØªØ¬Ùˆ
  searchData = {
    pageNumber: 1,
    pageSize: 3,
    sortBy: 'Id',
    sortDirection: true,
    name: '',
    minPrice: 0,
    maxPrice: 0
  };

  constructor(
    private fb: FormBuilder,
    private productService: ProductService,
    private toastService: ToastService
  ) {}

  ngOnInit(): void {
    this.initForm();
    this.loadProducts();
  }

  // ---------------------------
  // ÙØ±Ù…
  // ---------------------------
  initForm() {
    this.productForm = this.fb.group({
      id: [null],
      name: ['', Validators.required],
      productCode: ['', Validators.required],
      price: [0, [Validators.required, Validators.min(0)]],
      countTypeId: [0, Validators.required],
    });
  }

// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª
loadProducts(): void {
  this._request.pageSize = 5;
  this.productService.getRecords(this._request).subscribe({
    next: (res: ApiResult<ProductViewDto[]>) => {
      if (res.isSucceeded) {
        this._baseResponse = res;
        this._productsView = res.data || [];
      } else {
        this.toastService.error(res.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª');
      }
    },
    error: (error) => {
      console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª:', error);
      this.toastService.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
    }
  });
}

  // ---------------------------
  // Ø§ÛŒØ¬Ø§Ø¯ / ÙˆÛŒØ±Ø§ÛŒØ´
  // ---------------------------
  onSubmit1() {
    if (this.productForm.valid) {
      const productData: ProductCreateDto = this.productForm.value;

      if (this.editMode && this.editingProductId != null) {
        this.productService.updateRecord(productData).subscribe((res: ApiResult<any>) => {
          if (res.isSucceeded) {
            this.afterSubmit();
            this.toastService.success('Ù…Ø­ØµÙˆÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯');
          } else {
            this.toastService.error(res.message || 'Ø®Ø·Ø§ Ø¯Ø± ÙˆÛŒØ±Ø§ÛŒØ´');
          }
        });
      } else {
        this.productService.insertRecord(productData).subscribe((res: ApiResult<any>) => {
          if (res.isSucceeded) {
            this.afterSubmit();
            this.toastService.success('Ù…Ø­ØµÙˆÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯');
          } else {
            this.toastService.error(res.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯');
          }
        });
      }
    }
  }

  afterSubmit() {
    this.loadProducts();
    this.showModal = false;
    this.productForm.reset();
    this.editMode = false;
    this.editingProductId = null;
  }

  // ---------------------------
  // ÙˆÛŒØ±Ø§ÛŒØ´
  // ---------------------------
  onEdit(productId: number) {
    this.editMode = true;
    this.editingProductId = productId;

    this.productService.getRecordById(productId).subscribe((res: ApiResult<ProductCreateDto>) => {
      if (res.isSucceeded && res.data) {
        const product = res.data;
        this.productForm.patchValue({
          id: product.id,
          name: product.name,
          productCode: product.productCode,
          price: product.price,
          countTypeId: product.countTypeId
        });
        this.showModal = true;
      } else {
        this.toastService.error('Ù…Ø­ØµÙˆÙ„ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯ ÛŒØ§ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª!');
      }
    });
  }

  // ---------------------------
  // ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ
  // ---------------------------
  changePage(pageNumber: number) {
    this._request.pageNumber = pageNumber;
    this.loadProducts();
  }

  // ---------------------------
  // Ø­Ø°Ù Ú¯Ø±ÙˆÙ‡ÛŒ
  // ---------------------------
  isSelected(productId: number): boolean {
    return this.selectedProductIds.includes(productId);
  }

  toggleSelection(productId: number): void {
    const index = this.selectedProductIds.indexOf(productId);
    if (index > -1) {
      this.selectedProductIds.splice(index, 1);
    } else {
      this.selectedProductIds.push(productId);
    }
  }

  deleteSelectedProducts(): void {
    this.productService.deleteRecords(this.selectedProductIds).subscribe((res: ApiResult<any>) => {
      if (res.isSucceeded) {
        this.afterSubmit();
        this.selectedProductIds = [];
        this.toastService.success('Ù…Ø­ØµÙˆÙ„Ø§Øª Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ Ø­Ø°Ù Ø´Ø¯Ù†Ø¯');
      } else {
        this.toastService.error(res.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ú¯Ø±ÙˆÙ‡ÛŒ');
      }
      this.showDeleteConfirm = false;
    });
  }

  // ---------------------------
  // Ø¬Ø³ØªØ¬Ùˆ
  // ---------------------------
  onSearch() {
    this.productService.searchProducts(this.searchData).subscribe(
      (result: ApiResult<ProductViewDto[]>) => {
        if (result.isSucceeded) {
          this._baseResponse = result;
          this._productsView = result.data || [];
          console.log('Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ:', this._productsView);
        } else {
          this.toastService.error(result.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ');
        }
      },
      (error) => {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ', error);
        this.toastService.error('Ø®Ø·Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
      }
    );
  }
}

===== FILE: src\app\views\shop\routes.ts =====
import { Routes } from '@angular/router';

export const routes: Routes = [
  {
    path: '',
    data: {
      title: 'shop'
    },
    children: [
      {
        path: '',
        redirectTo: 'coreui-icons',
        pathMatch: 'full'
      },
      {
        path: 'product',
        loadComponent: () => import('./product/product.component').then(m => m.ProductComponent),
        data: {
          title: 'Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª '
        }
      },
      {
        path: 'countType',
        loadComponent: () => import('./count-type/count-type.component').then(m => m.CountTypeComponent),
        data: {
          title: ' ÙˆØ§Ø­Ø¯ Ø´Ù…Ø§Ø±Ø´ '
        }
      },
      {
        path: 'inventory',
        loadComponent: () => import('./inventory/inventory.component').then(m => m.InventoryComponent),
        data: {
          title: ' Ø§Ù†Ø¨Ø§Ø±'
        }
      }
    ]
  }
];


===== FILE: src\app\views\utilities\toast-container\toast-container.component.html =====
<p>toast-container works!</p>


===== FILE: src\app\views\utilities\toast-container\toast-container.component.scss =====


===== FILE: src\app\views\utilities\toast-container\toast-container.component.spec.ts =====
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { ToastContainerComponent } from './toast-container.component';

describe('ToastContainerComponent', () => {
  let component: ToastContainerComponent;
  let fixture: ComponentFixture<ToastContainerComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [ToastContainerComponent]
    })
    .compileComponents();

    fixture = TestBed.createComponent(ToastContainerComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});


===== FILE: src\app\views\utilities\toast-container\toast-container.component.ts =====
// toast-container.component.ts
import { Component, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import {
  ToasterComponent,
  ToastComponent,
  ToastHeaderComponent,
  ToastBodyComponent,
} from '@coreui/angular';
import { ToastService } from './../../../services/utilities/toast.service';
import { NgFor } from '@angular/common';

@Component({
  selector: 'app-toast-container',
  standalone: true,
  imports: [
    CommonModule,
    ToasterComponent,
    ToastComponent,
    ToastHeaderComponent,
    ToastBodyComponent,
    NgFor,
  ],
  template: `
    <c-toaster [placement]="'top-end'" class="p-3" position="fixed">
      <c-toast
        *ngFor="let toast of toastService.toasts()"
        [autohide]="true"
        [delay]="toast.duration"
        [color]="mapTypeToColor(toast.type)"
        [visible]="true"
        (visibleChange)="onVisibleChange(toast.id, $event)"
      >
        <c-toast-header>
          <strong class="me-auto">{{ toast.title }}</strong>
        </c-toast-header>
        <c-toast-body>
          {{ toast.message }}
        </c-toast-body>
      </c-toast>
    </c-toaster>
  `,
})
export class ToastContainerComponent {
  toastService = inject(ToastService);

  mapTypeToColor(type: string) {
    switch (type) {
      case 'success': return 'success';
      case 'error': return 'danger';
      case 'warning': return 'warning';
      default: return 'info';
    }
  }

  onVisibleChange(id: number, visible: boolean) {
    if (!visible) {
      this.toastService.removeToast(id);
    }
  }
}


===== FILE: src\app\views\utilities\toast-container\toast-sample-icon.component.ts =====
import { Component } from '@angular/core';

@Component({
  selector: 'toast-sample-icon',
  template: `<svg
    class="rounded me-2"
    width="20"
    height="20"
    xmlns="http://www.w3.org/2000/svg"
    preserveAspectRatio="xMidYMid slice"
    focusable="false"
    role="img"
  >
    <rect width="100%" height="100%" fill="#007aff"></rect>
  </svg>`,
  standalone: true
})
export class ToastSampleIconComponent {}


===== FILE: src\app\app.component.spec.ts =====
import { TestBed } from '@angular/core/testing';
import { provideRouter } from '@angular/router';
import { AppComponent } from './app.component';

describe('AppComponent', () => {
  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [
        AppComponent
      ],
      providers: [provideRouter([])]
    }).compileComponents();
  });

  it('should create the app', () => {
    const fixture = TestBed.createComponent(AppComponent);
    const app = fixture.componentInstance;
    expect(app).toBeTruthy();
  });

  it(`should have as title 'CoreUI Angular Admin Template'`, () => {
    const fixture = TestBed.createComponent(AppComponent);
    const app = fixture.componentInstance;
    expect(app.title).toEqual('CoreUI Angular Admin Template');
  });
});


===== FILE: src\app\app.component.ts =====
import { Component, DestroyRef, inject, OnInit } from '@angular/core';
import { takeUntilDestroyed } from '@angular/core/rxjs-interop';
import { Title } from '@angular/platform-browser';
import { ActivatedRoute, NavigationEnd, Router, RouterOutlet } from '@angular/router';
import { delay, filter, map, tap } from 'rxjs/operators';

import { ColorModeService } from '@coreui/angular';
import { IconSetService } from '@coreui/icons-angular';
import { iconSubset } from './icons/icon-subset';
import { ToastContainerComponent } from './views/utilities/toast-container/toast-container.component';

@Component({
    selector: 'app-root',
    template: `
    <app-toast-container></app-toast-container> 
    <router-outlet />
  `,
    imports: [RouterOutlet , ToastContainerComponent]
})
export class AppComponent implements OnInit {
  title = 'CRM';

  readonly #destroyRef: DestroyRef = inject(DestroyRef);
  readonly #activatedRoute: ActivatedRoute = inject(ActivatedRoute);
  readonly #router = inject(Router);
  readonly #titleService = inject(Title);

  readonly #colorModeService = inject(ColorModeService);
  readonly #iconSetService = inject(IconSetService);

  constructor() {
    this.#titleService.setTitle(this.title);
    // iconSet singleton
    this.#iconSetService.icons = { ...iconSubset };
    this.#colorModeService.localStorageItemName.set('coreui-free-angular-admin-template-theme-default');
    this.#colorModeService.eventName.set('ColorSchemeChange');
  }

  ngOnInit(): void {

    this.#router.events.pipe(
        takeUntilDestroyed(this.#destroyRef)
      ).subscribe((evt) => {
      if (!(evt instanceof NavigationEnd)) {
        return;
      }
    });

    this.#activatedRoute.queryParams
      .pipe(
        delay(1),
        map(params => <string>params['theme']?.match(/^[A-Za-z0-9\s]+/)?.[0]),
        filter(theme => ['dark', 'light', 'auto'].includes(theme)),
        tap(theme => {
          this.#colorModeService.colorMode.set(theme);
        }),
        takeUntilDestroyed(this.#destroyRef)
      )
      .subscribe();
  }
}


===== FILE: src\app\app.config.ts =====
import { ApplicationConfig, importProvidersFrom } from '@angular/core';
import { provideAnimationsAsync } from '@angular/platform-browser/animations/async';
import {authInterceptor} from './core/interceptors/auth.interceptor';
import {
  provideRouter,
  withEnabledBlockingInitialNavigation,
  withHashLocation,
  withInMemoryScrolling,
  withRouterConfig,
  withViewTransitions
} from '@angular/router';

import { DropdownModule, SidebarModule } from '@coreui/angular';
import { IconSetService } from '@coreui/icons-angular';
import { routes } from './app.routes';
import { provideHttpClient, withInterceptors } from '@angular/common/http';

export const appConfig: ApplicationConfig = {
  providers: [
    provideRouter(routes,
      withRouterConfig({
        onSameUrlNavigation: 'reload'
      }),
      withInMemoryScrolling({
        scrollPositionRestoration: 'top',
        anchorScrolling: 'enabled'
      }),
      withEnabledBlockingInitialNavigation(),
      withViewTransitions(),
      withHashLocation()
    ),
    importProvidersFrom(SidebarModule, DropdownModule),
    IconSetService,
    provideAnimationsAsync(),
    provideHttpClient(withInterceptors([authInterceptor]))
  ]
};


===== FILE: src\app\app.routes.ts =====
import { Routes } from '@angular/router';
import { DefaultLayoutComponent } from './layout';
import { authGuard } from './services/auth/login/auth.guard';

export const routes: Routes = [
  {
    path: '',
    redirectTo: 'dashboard',
    pathMatch: 'full'
  },
  {
    path: '',
    component: DefaultLayoutComponent,
     canActivate: [authGuard],
    data: {
      title: 'Home'
    },
    children: [
      {
        path: 'shop',
        loadChildren: () => import ('./views/shop/routes').then((m) => m.routes)

      }
      ,
      {
        path: 'base',
        loadChildren: () => import ('./views/base/routes').then((m) => m.routes)

      }
      ,
      {
        path: 'dashboard',
        loadComponent: () => import('./views/shop/product/product.component').then(m => m.ProductComponent)
      },
      {
        path: 'template',
        loadChildren: () => import('./views/template/routes').then((m) => m.routes)
      },
      {
        path: 'chat',
        loadComponent: () => import('./views/chat/chat/chat.component').then(m => m.ChatComponent),
        data: { title: 'Ú†Øª' }
      }

    ]
  } ,
    // ðŸ‘‡ Ù…Ø³ÛŒØ± Ù„Ø§Ú¯ÛŒÙ† Ø¬Ø¯Ø§ Ø¨Ø§Ø´Ù‡ Ø¨Ø¯ÙˆÙ† Ú¯Ø§Ø±Ø¯
  {
    path: 'login',
    loadComponent: () => import('./views/base/login/loginForm/login/login.component').then(m => m.LoginComponent)
  }
];


===== FILE: src\environments\environment.prod.ts =====
// src/environments/environment.prod.ts
export const environment = {
    production: true,
    apiUrl: ''   // Ø¯Ø± Ù¾Ø±ÙˆØ¯Ø§Ú©Ø´Ù† Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø®Ø§Ù„ÛŒ Ù…ÛŒâ€ŒØ°Ø§Ø±ÛŒÙ… Ú†ÙˆÙ† Ø§Ø² Ù‡Ù…ÙˆÙ† Ø¯Ø§Ù…Ù†Ù‡ Ø³Ø±Ùˆ Ù…ÛŒâ€ŒØ´Ù‡
  };

===== FILE: src\environments\environment.ts =====
// src/environments/environment.ts
export const environment = {
    production: false,
    apiUrl: 'http://localhost:90'   // ÛŒØ§ Ù‡Ø± Ù¾ÙˆØ±ØªÛŒ Ú©Ù‡ Ø¨Ú©â€ŒØ§Ù†Ø¯Øª Ø¯Ø§Ø±Ù‡ (Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ 90 ÛŒØ§ 5000)
  };


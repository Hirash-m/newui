===== FILE: src\app\services\base\userManage\user-manage.service.ts =====
// src/app/services/base/userManage/user-manage.service.ts

import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { catchError } from 'rxjs/operators';
import { Domain } from 'src/utilities/path';
import { ToastService } from '../../utilities/toast.service';
import { ListRequest } from 'src/app/dto/ListRequestDto';
import { UserCreateFormData, UserDto } from 'src/app/dto/base/UserDto';
import { BaseService } from '../../utilities/base.service';
import { ApiResult } from 'src/app/dto/api-result';

@Injectable({
  providedIn: 'root'
})
export class UserManageService extends BaseService<UserDto, UserDto> {
  protected override endpoint = '/api/user';


}

===== FILE: src\app\services\shop\countType\count-type.service.spec.ts =====
import { TestBed } from '@angular/core/testing';

import { CountTypeService } from './count-type.service';

describe('CountTypeService', () => {
  let service: CountTypeService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(CountTypeService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


===== FILE: src\app\services\shop\countType\count-type.service.ts =====
// Angular Imports
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';

// Shared & Utility Imports
import { ToastService } from '../../utilities/toast.service';
import { BaseService } from '../../utilities/base.service';
import { Domain } from 'src/utilities/path';

// DTO Imports
import { CountTypeDto } from './../../../dto/shop/CountTypeDto';


// RxJS Imports
import { catchError, Observable, throwError } from 'rxjs';


// ==========================================================================
// â¬‡ï¸ Service Definition: CountTypeService
// ==========================================================================
@Injectable({
  providedIn: 'root'
})
export class CountTypeService extends BaseService<CountTypeDto , CountTypeDto> {
protected  endpoint= '/api/counttype';

}


===== FILE: src\app\services\shop\inventory\inventory.service.spec.ts =====
import { TestBed } from '@angular/core/testing';

import { InventoryService } from './inventory.service';

describe('InventoryService', () => {
  let service: InventoryService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(InventoryService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


===== FILE: src\app\services\shop\inventory\inventory.service.ts =====
import { Injectable } from '@angular/core';
import { BaseService } from '../../utilities/base.service';
import {InventoryDto} from 'src/app/dto/shop/InventoryDto'

@Injectable({
  providedIn: 'root'
})
export class InventoryService extends BaseService<InventoryDto , InventoryDto> {

  protected endpoint='/api/inv';
   

}


===== FILE: src\app\services\shop\product\product.service.spec.ts =====
import { TestBed } from '@angular/core/testing';

import { ProductService } from '../product/product.service';

describe('ProductService', () => {
  let service: ProductService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(ProductService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


===== FILE: src\app\services\shop\product\product.service.ts =====
import { ToastService } from '../../utilities/toast.service';
import { ListRequest } from '../../../dto/ListRequestDto';
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Domain } from '../../../../utilities/path';
import { Injectable } from '@angular/core';
import { catchError, map, Observable, throwError } from 'rxjs';
import { ProductCreateDto, ProductViewDto } from '../../../dto/shop/ProductDto';
import { BaseService } from '../../utilities/base.service';
import { ApiResult } from 'src/app/dto/api-result';

@Injectable({
  providedIn: 'root'
})
export class ProductService extends BaseService<ProductViewDto, ProductCreateDto> {
  protected endpoint='/api/product';
  private apiurl = Domain;







 

  /** Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø­ØµÙˆÙ„ Ø¨Ø§ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ */
  searchProducts(request: ListRequest): Observable<ApiResult<ProductViewDto[]>> {


    return this.http.post<ApiResult<ProductViewDto[]>>(`${this.apiurl}/api/product/search`, request, { headers: this.getJsonHeaders() }).pipe(
      catchError(error => {
        //this.toast.showToast.error({ message: 'Ø®Ø·Ø§ Ø¯Ø± ØªØ±Ø§Ú©Ù†Ø´ ' });
        this.toast.error("need change");
        return throwError(() => error);
      })
    );
  }

}


===== FILE: src\app\services\utilities\base.service.spec.ts =====
// src/app/services/utilities/mock-base.service.ts
import { Injectable } from '@angular/core';
import { BaseService } from './base.service';

@Injectable()
export class MockBaseService extends BaseService<any, any> {
  protected endpoint = '/api/test'; // ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù…Ù¾Ø§ÛŒÙ„ Ø´Ø¯Ù†

  constructor() {
    super(null!, null!); // HttpClient Ùˆ ToastService Ø±Ùˆ null Ù…ÛŒâ€ŒØ°Ø§Ø±ÛŒÙ… Ú†ÙˆÙ† ØªØ³Øª ÙˆØ§Ø­Ø¯ Ù‡Ø³Øª
  }
}

===== FILE: src\app\services\utilities\base.service.ts =====
// src/app/services/utilities/base.service.ts

import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Observable, throwError } from 'rxjs';
import { catchError } from 'rxjs/operators';
import { ToastService } from './toast.service';
import { ApiResult } from '../../dto/api-result';
import { ListRequest } from '../../dto/ListRequestDto';
import { Domain } from '../../../utilities/path';

@Injectable({ providedIn: 'root' })
export abstract class BaseService<TViewDto, TCreateDto = TViewDto> {
  protected apiUrl = Domain;
  protected abstract endpoint: string;

  constructor(
    protected http: HttpClient,
    protected toast: ToastService
  ) {}

  protected getJsonHeaders(): HttpHeaders {
    return new HttpHeaders({
      accept: 'application/json',
      'Content-Type': 'application/json',
    });
  }

  // Ù„ÛŒØ³Øª: Ù‡Ù…ÛŒØ´Ù‡ TViewDto[]
  getRecords(request: ListRequest): Observable<ApiResult<TViewDto[]>> {
    return this.http
      .post<ApiResult<TViewDto[]>>(
        `${this.apiUrl}${this.endpoint}/GetAll`,
        request,
        { headers: this.getJsonHeaders() }
      )
      .pipe(catchError(err => this.handleError(err)));
  }

  // Ø§ÛŒØ¬Ø§Ø¯
  insertRecord(data: TCreateDto): Observable<ApiResult<TCreateDto>> {
    return this.http
      .post<ApiResult<TCreateDto>>(
        `${this.apiUrl}${this.endpoint}/create`,
        data,
        { headers: this.getJsonHeaders() }
      )
      .pipe(catchError(err => this.handleError(err)));
  }

  // ÙˆÛŒØ±Ø§ÛŒØ´
  updateRecord(data: TCreateDto): Observable<ApiResult<TCreateDto>> {
    return this.http
      .post<ApiResult<TCreateDto>>(
        `${this.apiUrl}${this.endpoint}/update`,
        data,
        { headers: this.getJsonHeaders() }
      )
      .pipe(catchError(err => this.handleError(err)));
  }

  // Ø­Ø°Ù Ú†Ù†Ø¯ØªØ§ÛŒÛŒ
  deleteRecords(ids: number[]): Observable<ApiResult<any>> {
    return this.http
      .post<ApiResult<any>>(
        `${this.apiUrl}${this.endpoint}/delete`,
        ids,
        { headers: this.getJsonHeaders() }
      )
      .pipe(catchError(err => this.handleError(err)));
  }

  // Ø¯Ø±ÛŒØ§ÙØª ÛŒÚ© Ø±Ú©ÙˆØ±Ø¯
  getRecordById(id: number): Observable<ApiResult<TCreateDto>> {
    return this.http
      .get<ApiResult<TCreateDto>>(
        `${this.apiUrl}${this.endpoint}/getById/?id=${id}`,
        { headers: this.getJsonHeaders() }
      )
      .pipe(catchError(err => this.handleError(err)));
  }

  // ÙØ±Ù… Ø§ÛŒØ¬Ø§Ø¯ (Ù…Ø«Ù„ roles, permissions)
  getCreateForm<U = any>(): Observable<ApiResult<U>> {
    return this.http
      .get<ApiResult<U>>(
        `${this.apiUrl}${this.endpoint}/getcreateform`,
        { headers: this.getJsonHeaders() }
      )
      .pipe(catchError(err => this.handleError(err)));
  }

  // --- Ø®Ø·Ø§ ---
  protected handleError(error: any): Observable<never> {
    // Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø§ÛŒÙ†Ø¬Ø§ Ù„Ø§Ú¯ Ø¨Ø²Ù†ÛŒ
    console.error('API Error:', error);
    return throwError(() => error);
  }

  // --- Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… ---
  protected showApiResultToast(result: ApiResult<any>): void {
    if (!result) return;

    if (result.isSucceeded) {
      if (result.message) {
        this.toast.success(result.message);
      }
    } else {
      const errorMsg = result.errors?.[0] ?? result.message ?? 'Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯';
      this.toast.error(errorMsg);
    }
  }
}

===== FILE: src\app\services\utilities\toast.service.spec.ts =====
import { TestBed } from '@angular/core/testing';

import { ToastService } from './toast.service';

describe('ToastService', () => {
  let service: ToastService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(ToastService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


===== FILE: src\app\services\utilities\toast.service.ts =====
// src/app/services/utilities/toast.service.ts

import { Injectable, signal } from '@angular/core';
import { HttpErrorResponse } from '@angular/common/http';
import { ApiResult } from 'src/app/dto/api-result';

export type ToastType = 'success' | 'error' | 'warning' | 'info';

export interface ToastData {
  id: number;
  title: string;
  message: string;
  type: ToastType;
  duration?: number;
}

@Injectable({ providedIn: 'root' })
export class ToastService {
  private counter = 0;
  toasts = signal<ToastData[]>([]);

  // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶
  private defaults = {
    success: { title: 'Ø¹Ù…Ù„ÛŒØ§Øª Ù…ÙˆÙÙ‚', duration: 4000 },
    error: { title: 'Ø®Ø·Ø§', duration: 6000 },
    warning: { title: 'Ø§Ø®Ø·Ø§Ø±', duration: 5000 },
    info: { title: 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª', duration: 4000 },
  };

  // Ù…ØªØ¯ Ø§ØµÙ„ÛŒ Ù†Ù…Ø§ÛŒØ´ Toast
  private show(type: ToastType, message: string, title?: string, duration?: number): void {
    const id = this.counter++;
    const config = this.defaults[type];

    const toast: ToastData = {
      id,
      type,
      title: title ?? config.title,
      message,
      duration: duration ?? config.duration,
    };

    this.toasts.update(list => [...list, toast]);
    setTimeout(() => this.remove(id), toast.duration);
  }

  // Ù…ØªØ¯Ù‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ
  success(message: string, title?: string): void {
    this.show('success', message, title);
  }

  error(message: string, title?: string): void {
    this.show('error', message, title);
  }

  warning(message: string, title?: string): void {
    this.show('warning', message, title);
  }

  info(message: string, title?: string): void {
    this.show('info', message, title);
  }

  remove(id: number): void {
    this.toasts.update(list => list.filter(t => t.id !== id));
  }
  removeToast(id: number): void {
    this.toasts.update(list => list.filter(t => t.id !== id));
  }
  // --- ÙÙ‚Ø· Ù¾ÛŒØ§Ù… Ø§Ø² ApiResult â€” Ø¨Ø¯ÙˆÙ† fallback Ù…Ø­Ù„ÛŒ ---
  handleApiResponse<T>(result: ApiResult<T>): void {
    if (result.isSucceeded) {
      if (result.message) {
        this.success(result.message);
      }
      // Ø§Ú¯Ø± message Ù†Ø¨ÙˆØ¯ â†’ Ù‡ÛŒÚ† ØªÙˆØ³ØªÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯
    } else {
      this.handleApiError(result);
    }
  }
  

  // --- Ù‡Ù†Ø¯Ù„ Ú©Ø±Ø¯Ù† Ø®Ø·Ø§Ù‡Ø§ÛŒ ApiResult Ø¨Ø§ Ú†Ú© statusCode Ø§ÛŒÙ…Ù† ---
  private handleApiError(result: ApiResult): void {
    const errors = result.errors ?? [];
    const message = errors.length > 0 ? errors[0] : result.message ?? 'Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯.';

    const status = result.statusCode;

    if (status === 401) {
      this.warning(message, 'Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª');
    } else if (status === 403) {
      this.warning(message, 'Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ù…Ù†ÙˆØ¹');
    } else if (status != null && status >= 400 && status < 500) {
      this.error(message, 'Ø®Ø·Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ');
    } else {
      this.error(message); // 500 ÛŒØ§ Ø¨Ø¯ÙˆÙ† statusCode
    }
  }

  // --- ÙÙ‚Ø· Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø®Ø§Ù… HTTP (Ø¨Ø¯ÙˆÙ† ApiResult) ---
  handleHttpError(error: HttpErrorResponse): void {
    let message = 'Ø®Ø·Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±';

    if (error.error instanceof ErrorEvent) {
      // Ø®Ø·Ø§ÛŒ Ú©Ù„Ø§ÛŒÙ†Øª
      message = `Ø®Ø·Ø§: ${error.error.message}`;
    } else {
      // Ø®Ø·Ø§ÛŒ Ø³Ø±ÙˆØ±
      const status = error.status;
      const body = error.error;

      if (status === 0) {
        message = 'Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø¨Ø±Ù‚Ø±Ø§Ø± Ù†ÛŒØ³Øª.';
      } else if (status === 500) {
        message = 'Ø®Ø·Ø§ÛŒ Ø¯Ø§Ø®Ù„ÛŒ Ø³Ø±ÙˆØ±.';
      } else if (status === 404) {
        message = 'Ù…Ù†Ø¨Ø¹ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.';
      } else if (body && typeof body === 'object' && 'message' in body) {
        message = (body as any).message;
      } else if (typeof body === 'string') {
        message = body;
      }
    }

    this.error(message);
  
  
  }

  
}

===== FILE: src\app\views\base\login\loginForm\login\login.component.html =====
<div class="bg-light dark:bg-transparent min-vh-100 d-flex flex-row align-items-center">
  <c-container breakpoint="md">
    <c-row class="justify-content-center">
      <c-col lg="10" xl="8">
        <c-card-group>
          <c-card class="p-4">
            <c-card-body>
              <form cForm (ngSubmit)="onLogin()">
                <h1>ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…</h1>
                <p class="text-body-secondary">Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>

                <c-input-group class="mb-3">
                  <span cInputGroupText>
                    <svg cIcon name="cilUser"></svg>
                  </span>
                  <input
                    type="email"
                    autoComplete="username"
                    cFormControl
                    placeholder="Ø§ÛŒÙ…ÛŒÙ„"
                    [(ngModel)]="email"
                    name="email"
                    required
                  />
                </c-input-group>

                <c-input-group class="mb-4">
                  <span cInputGroupText>
                    <svg cIcon name="cilLockLocked"></svg>
                  </span>
                  <input
                    type="password"
                    autoComplete="current-password"
                    cFormControl
                    placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±"
                    [(ngModel)]="password"
                    name="password"
                    required
                  />
                </c-input-group>

                <c-row>
                  <c-col xs="12" class="text-center">
                    <button
                      cButton
                      class="px-4"
                      color="primary"
                      type="submit"
                      [disabled]="loading"
                    >
                      {{ loading ? 'Ø¯Ø± Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯...' : 'ÙˆØ±ÙˆØ¯' }}
                    </button>
                  </c-col>
                </c-row>

                <!--
                <c-row class="mt-3">
                  <c-col class="text-right" xs="6">
                    <button cButton class="px-0" color="link" type="button">
                      ÙØ±Ø§Ù…ÙˆØ´ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±ØŸ
                    </button>
                  </c-col>
                </c-row>
                -->
              </form>
            </c-card-body>
          </c-card>

          <!--
          <c-card [ngStyle]="{'minWidth.%': 44}" class="text-white bg-primary py-5">
            <c-card-body class="text-center">
              <div>
                <h2>Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</h2>
                <p>
                  Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø³Ø§Ù…Ø§Ù†Ù‡ØŒ ÛŒÚ© Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯.
                </p>
                <button
                  [active]="true"
                  cButton
                  class="mt-3"
                  color="primary"
                  routerLink="/register"
                >
                  Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯
                </button>
              </div>
            </c-card-body>
          </c-card>
          -->
        </c-card-group>
      </c-col>
    </c-row>
  </c-container>
</div>



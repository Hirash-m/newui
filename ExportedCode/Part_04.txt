===== FILE: src\app\services\base\navigation\navigation.service.ts =====
// src/app/services/navigation/navigation.service.ts
import { Injectable, inject } from '@angular/core';
import { INavData } from '@coreui/angular';
import { AuthService } from 'src/app/services/auth/login/auth.service';

@Injectable({
  providedIn: 'root'
})
export class NavigationService {
  private authService = inject(AuthService);

  // Ú©Ø´ Ù…Ù†ÙˆÙ‡Ø§
  private cachedNavItems: INavData[] | null = null;

  getNavItems(): INavData[] {
    // Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ØŒ Ù‡Ù…ÙˆÙ† Ø±Ùˆ Ø¨Ø±Ú¯Ø±Ø¯ÙˆÙ†
    if (this.cachedNavItems) {
      return this.cachedNavItems;
    }

    const hasPermission = (perm: string) => this.authService.hasPermission(perm);

    const baseChildren: INavData[] = [
      {
        name: 'Ú©Ø§Ø±Ø¨Ø±Ø§Ù†',
        url: '/base/user',
        badge: { color: 'info', text: 'NEW' },
        iconComponent: { name: 'cil-user' },
        visible: hasPermission('User.View')
      }
    ].filter(item => item.visible !== false);

    const chatItem = {
      name: 'Ú†Øª',
      url: '/chat',
      badge: { color: 'info', text: 'NEW' },
      iconComponent: { name: 'cil-comment-square' },
      //visible: hasPermission('Chat.Access') // Ø§Ú¯Ø± Ù…Ø¬ÙˆØ² Ø¯Ø§Ø±Ù‡
    };

    const shopChildren: INavData[] = [
      {
        name: 'Ù…Ø­ØµÙˆÙ„Ø§Øª',
        url: '/shop/product',
        badge: { color: 'info', text: 'NEW' },
        iconComponent: { name: 'cil-basket' },
        visible: hasPermission('Product.View')
      },
      {
        name: 'ÙˆØ§Ø­Ø¯ Ø´Ù…Ø§Ø±Ø´',
        url: '/shop/countType',
        badge: { color: 'info', text: 'NEW' },
        iconComponent: { name: 'cil-calculator' },
        visible: hasPermission('CountType.View')
      },
      {
        name: 'Ø§Ù†Ø¨Ø§Ø±',
        url: '/shop/inventory',
        badge: { color: 'info', text: 'NEW' },
        iconComponent: { name: 'cil-storage' },
        visible: hasPermission('Inventory.View')
      },
      
    ].filter(item => item.visible !== false);

    const templateChildren: INavData[] = [
      {
        name: 'Dashboard',
        url: '/template/dashboard',
        iconComponent: { name: 'cil-speedometer' },
        badge: { color: 'info', text: 'NEW' }
      },
      { title: true, name: 'Theme' },
      { name: 'Colors', url: '/template/theme/colors', iconComponent: { name: 'cil-drop' } },
      { name: 'Typography', url: '/template/theme/typography', linkProps: { fragment: 'headings' }, iconComponent: { name: 'cil-pencil' } },
      { name: 'Components', title: true },
      {
        name: 'Base',
        url: '/template/base',
        iconComponent: { name: 'cil-puzzle' },
        children: [
          { name: 'Accordion', url: '/template/base/accordion', icon: 'nav-icon-bullet' },
          { name: 'Breadcrumbs', url: '/template/base/breadcrumbs', icon: 'nav-icon-bullet' },
          { name: 'Cards', url: '/template/base/cards', icon: 'nav-icon-bullet' },
          { name: 'Carousel', url: '/template/base/carousel', icon: 'nav-icon-bullet' },
          { name: 'Collapse', url: '/template/base/collapse', icon: 'nav-icon-bullet' },
          { name: 'List Group', url: '/template/base/list-group', icon: 'nav-icon-bullet' },
          { name: 'Navs & Tabs', url: '/template/base/navs', icon: 'nav-icon-bullet' },
          { name: 'Pagination', url: '/template/base/pagination', icon: 'nav-icon-bullet' },
          { name: 'Placeholder', url: '/template/base/placeholder', icon: 'nav-icon-bullet' },
          { name: 'Popovers', url: '/template/base/popovers', icon: 'nav-icon-bullet' },
          { name: 'Progress', url: '/template/base/progress', icon: 'nav-icon-bullet' },
          { name: 'Spinners', url: '/template/base/spinners', icon: 'nav-icon-bullet' },
          { name: 'Tables', url: '/template/base/tables', icon: 'nav-icon-bullet' },
          { name: 'Tabs', url: '/template/base/tabs', icon: 'nav-icon-bullet' },
          { name: 'Tooltips', url: '/template/base/tooltips', icon: 'nav-icon-bullet' }
        ]
      },
      {
        name: 'Buttons',
        url: '/template/buttons',
        iconComponent: { name: 'cil-cursor' },
        children: [
          { name: 'Buttons', url: '/template/buttons/buttons', icon: 'nav-icon-bullet' },
          { name: 'Button groups', url: '/template/buttons/button-groups', icon: 'nav-icon-bullet' },
          { name: 'Dropdowns', url: '/template/buttons/dropdowns', icon: 'nav-icon-bullet' }
        ]
      },
      {
        name: 'Forms',
        url: '/template/forms',
        iconComponent: { name: 'cil-notes' },
        children: [
          { name: 'Form Control', url: '/template/forms/form-control', icon: 'nav-icon-bullet' },
          { name: 'Select', url: '/template/forms/select', icon: 'nav-icon-bullet' },
          { name: 'Checks & Radios', url: '/template/forms/checks-radios', icon: 'nav-icon-bullet' },
          { name: 'Range', url: '/template/forms/range', icon: 'nav-icon-bullet' },
          { name: 'Input Group', url: '/template/forms/input-group', icon: 'nav-icon-bullet' },
          { name: 'Floating Labels', url: '/template/forms/floating-labels', icon: 'nav-icon-bullet' },
          { name: 'Layout', url: '/template/forms/layout', icon: 'nav-icon-bullet' },
          { name: 'Validation', url: '/template/forms/validation', icon: 'nav-icon-bullet' }
        ]
      },
      { name: 'Charts', iconComponent: { name: 'cil-chart-pie' }, url: '/template/charts' },
      {
        name: 'Icons',
        iconComponent: { name: 'cil-star' },
        url: '/template/icons',
        children: [
          { name: 'CoreUI Free', url: '/template/icons/coreui-icons', icon: 'nav-icon-bullet', badge: { color: 'success', text: 'FREE' } },
          { name: 'CoreUI Flags', url: '/template/icons/flags', icon: 'nav-icon-bullet' },
          { name: 'CoreUI Brands', url: '/template/icons/brands', icon: 'nav-icon-bullet' }
        ]
      },
      {
        name: 'Notifications',
        url: '/template/notifications',
        iconComponent: { name: 'cil-bell' },
        children: [
          { name: 'Alerts', url: '/template/notifications/alerts', icon: 'nav-icon-bullet' },
          { name: 'Badges', url: '/template/notifications/badges', icon: 'nav-icon-bullet' },
          { name: 'Modal', url: '/template/notifications/modal', icon: 'nav-icon-bullet' },
          { name: 'Toast', url: '/template/notifications/toasts', icon: 'nav-icon-bullet' }
        ]
      },
      {
        name: 'Widgets',
        url: '/template/widgets',
        iconComponent: { name: 'cil-calculator' },
        badge: { color: 'info', text: 'NEW' }
      },
      { title: true, name: 'Extras' },
      {
        name: 'Pages',
        url: '/template/login',
        iconComponent: { name: 'cil-star' },
        children: [
          { name: 'Login', url: '/template/login', icon: 'nav-icon-bullet' },
          { name: 'Register', url: '/template/register', icon: 'nav-icon-bullet' },
          { name: 'Error 404', url: '/template/404', icon: 'nav-icon-bullet' },
          { name: 'Error 500', url: '/template/500', icon: 'nav-icon-bullet' }
        ]
      },
      { title: true, name: 'Links', class: 'mt-auto' },
      {
        name: 'Docs',
        url: 'https://coreui.io/angular/docs/',
        iconComponent: { name: 'cil-description' },
        attributes: { target: '_blank' }
      }
    ];

    const navItems: INavData[] = [
      { title: true, name: 'Ø§ØµÙ„ÛŒ' },

      ...(baseChildren.length > 0 ? [{
        name: 'Ù¾Ø§ÛŒÙ‡',
        url: '/base',
        iconComponent: { name: 'cil-cart' },
        children: baseChildren
      }] : []),

      ...(shopChildren.length > 0 ? [{
        name: 'ÙØ±ÙˆØ´Ú¯Ø§Ù‡',
        url: '/shop',
        iconComponent: { name: 'cil-cart' },
        children: shopChildren
      }] : []),

      {
        name: 'Ù‚Ø§Ù„Ø¨',
        url: '/template',
        iconComponent: { name: 'cil-puzzle' },
        children: templateChildren
      }
    ];

    // Ú©Ø´ Ú©Ø±Ø¯Ù†
    this.cachedNavItems = navItems;
    return navItems;
  }

  // Ù…ØªØ¯ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ø´ (Ù…Ø«Ù„Ø§Ù‹ Ø¨Ø¹Ø¯ Ø§Ø² Ù„Ø§Ú¯ÛŒÙ†/Ù„Ø§Ú¯â€ŒØ§ÙˆØª)
  invalidateCache(): void {
    this.cachedNavItems = null;
  }
}

===== FILE: src\app\services\base\userManage\user-manage.service.spec.ts =====
import { TestBed } from '@angular/core/testing';

import { UserManageService } from './user-manage.service';

describe('UserManageService', () => {
  let service: UserManageService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(UserManageService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


===== FILE: src\app\services\base\userManage\user-manage.service.ts =====
// src/app/services/base/userManage/user-manage.service.ts

import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { catchError } from 'rxjs/operators';
import { Domain } from 'src/utilities/path';
import { ToastService } from '../../utilities/toast.service';
import { ListRequest } from 'src/app/dto/ListRequestDto';
import { UserCreateFormData, UserDto } from 'src/app/dto/base/UserDto';
import { BaseService } from '../../utilities/base.service';
import { ApiResult } from 'src/app/dto/api-result';

@Injectable({
  providedIn: 'root'
})
export class UserManageService extends BaseService<UserDto, UserDto> {
  protected override endpoint = '/api/user';

  constructor(
    http: HttpClient,
    private toastService: ToastService  // Ø§ÛŒÙ†Ø¬Ø§ ØªØ²Ø±ÛŒÙ‚ Ù…ÛŒâ€ŒØ´Ù‡
  ) {
    super(http , toastService ); // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ constructor Ù¾Ø¯Ø±
  }


  // === Override insertRecord Ø¨Ø§ FormData ===
  override insertRecord(data: UserDto): Observable<ApiResult<any>> {
    const formData = this.buildFormData(data);
    return this.http.post<ApiResult<any>>(`${Domain}${this.endpoint}/create`, formData).pipe(
      catchError(err => {
        this.toastService.error('Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±');
        throw err;
      })
    );
  }



 
  // === Override updateRecord Ø¨Ø§ FormData ===
  override updateRecord(data: UserDto): Observable<ApiResult<any>> {
    const formData = this.buildFormData(data);
    return this.http.post<ApiResult<any>>(`${Domain}${this.endpoint}/update`, formData).pipe(
      catchError(err => {
        this.toastService.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ø±Ø¨Ø±');
        throw err;
      })
    );
  }

  // === Ù…ØªØ¯ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª FormData ===
  private buildFormData(data: UserDto): FormData {
    const formData = new FormData();

    // ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡
    if (data.id) formData.append('Id', data.id.toString());
    formData.append('FullName', data.fullName || '');
    formData.append('Username', data.username || '');
    formData.append('Email', data.email || '');
    formData.append('Password', data.Password || '');

    // Ø¢Ø±Ø§ÛŒÙ‡ RoleIds (ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù…Ù‚Ø¯Ø§Ø±)
    if (data.roleIds && data.roleIds.length > 0) {
      data.roleIds.forEach(id => formData.append('RoleIds', id.toString()));
    } else {
      formData.append('RoleIds', ''); // ÛŒØ§ Ø­Ø°Ù Ú©Ù† Ø§Ú¯Ø± backend Ø§Ø¬Ø§Ø²Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡
    }

    // ÙØ§ÛŒÙ„ ProfilePicture (Ø§Ú¯Ø± File Ø¨Ø§Ø´Ø¯)
    if (data.profilePicture instanceof File) {
      formData.append('ProfilePicture', data.profilePicture, data.profilePicture.name);
    } else {
      formData.append('ProfilePicture', ''); // ÛŒØ§ Ø­Ø°Ù Ú©Ù†
    }

    return formData;
  }
}

===== FILE: src\app\services\chat\chat.service.spec.ts =====
import { TestBed } from '@angular/core/testing';

import { ChatService } from './chat.service';

describe('ChatService', () => {
  let service: ChatService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(ChatService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


===== FILE: src\app\services\chat\chat.service.ts =====
// src/app/services/chat/chat.service.ts
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { HubConnection, HubConnectionBuilder, HubConnectionState } from '@microsoft/signalr';
import { BehaviorSubject, Observable, from } from 'rxjs';
import { ApiResult } from '../../dto/api-result';
import { MessageDto, ChatListItem, SendMessageDto } from '../../dto/chat/MessageDto';
import { AuthService } from '../auth/login/auth.service';
import { ToastService } from '../utilities/toast.service';

@Injectable({
  providedIn: 'root'
})
export class ChatService {
  private hubConnection!: HubConnection;
  public messages$ = new BehaviorSubject<MessageDto[]>([]);
  public chatList$ = new BehaviorSubject<ChatListItem[]>([]);

  private currentUserId = this.authService.getUserId();

  constructor(
    private http: HttpClient,
    private authService: AuthService,
    private toast: ToastService
  ) {
    this.startConnection();
  }

  private startConnection(): void {
    const token = this.authService.getToken();

    this.hubConnection = new HubConnectionBuilder()
      .withUrl('/chatHub', {  // Ø¨Ø§ proxy Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù‡
        accessTokenFactory: () => token || ''
      })
      .withAutomaticReconnect()
      .build();

    this.hubConnection.start()
      .then(() => console.log('SignalR Connected'))
      .catch(err => console.error('SignalR Connection Error:', err));

    // Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯
    this.hubConnection.on('ReceiveMessage', (message: MessageDto) => {
      message.isMine = message.senderId === this.currentUserId;
      this.messages$.next([...this.messages$.value, message]);
      this.updateChatListOnNewMessage(message);
      this.scrollToBottom.next(true);
    });

    this.hubConnection.on('UserStatusChanged', (userId: number, isOnline: boolean) => {
      const list = this.chatList$.value;
      const user = list.find(u => u.userId === userId);
      if (user) {
        user.isOnline = isOnline;
        this.chatList$.next([...list]);
      }
    });
  }

  // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ unread
  private updateChatListOnNewMessage(message: MessageDto): void {
    if (message.receiverId !== this.currentUserId) return;

    const list = this.chatList$.value;
    const user = list.find(u => u.userId === message.senderId);
    if (user) {
      user.lastMessage = message.type === 'Text' ? message.content : (message.type === 'Image' ? 'ØªØµÙˆÛŒØ±' : 'ÙØ§ÛŒÙ„');
      user.lastMessageTime = message.sentAt;
      if (this.selectedUserId !== message.senderId) {
        user.unreadCount++;
      }
      this.chatList$.next([...list]);
    }
  }

  private selectedUserId: number | null = null;

  // 1. Ù„ÛŒØ³Øª Ú†Øª
  public loadChatList(): void {
    this.http.get<any>('/api/Chat/list').subscribe({
      next: (res) => {
        if (res.success && Array.isArray(res.data)) {
          const list: ChatListItem[] = res.data.map((item: any) => ({
            userId: item.userId,
            fullName: item.userName || 'Ú©Ø§Ø±Ø¨Ø± Ù†Ø§Ø´Ù†Ø§Ø³',
            lastMessage: item.lastMessage || 'Ø¨Ø¯ÙˆÙ† Ù¾ÛŒØ§Ù…',
            lastMessageTime: item.lastMessageTime ? new Date(item.lastMessageTime) : undefined,
            unreadCount: item.unreadCount || 0,
            isOnline: item.isOnline || false,
            lastSeen: item.lastSeen ? new Date(item.lastSeen) : null
          }));
          this.chatList$.next(list);
          console.log('Chat list loaded:', list); // Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¨Ø§Ú¯
        }
      },
      error: (err) => {
        console.error('Failed to load chat list:', err);
        this.toast.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ú†Øª');
      }
    });
  }

  // 2. ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú†Øª
  public loadChatHistory(userId: number): void {
    this.selectedUserId = userId;
    this.http.get<ApiResult<MessageDto[]>>(`/api/Chat/history/${userId}`).subscribe(res => {
      if (res.isSucceeded && res.data) {
        const messages = res.data.map(m => ({
          ...m,
          isMine: m.senderId === this.currentUserId
        }));
        this.messages$.next(messages.reverse());
        this.markAsRead(userId);
        this.scrollToBottom.next(true);
      }
    });
  }

  // 3. Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…
  public sendMessage(dto: SendMessageDto): Observable<any> {
    if (this.hubConnection.state === HubConnectionState.Connected) {
      return from(this.hubConnection.invoke('SendMessage', dto));
    }

    const formData = new FormData();
    formData.append('receiverId', dto.receiverId.toString());
    if (dto.content) formData.append('content', dto.content);
    if (dto.file) formData.append('file', dto.file, dto.file.name);
    formData.append('type', dto.type);

    return this.http.post('/api/Chat/send', formData);
  }

  // 4. Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯Ù‡
  public markAsRead(userId: number): void {
    this.http.post(`/api/Chat/mark-as-read/${userId}`, {}).subscribe();
    // Ø¢Ù¾Ø¯ÛŒØª Ù…Ø­Ù„ÛŒ unread
    const list = this.chatList$.value;
    const user = list.find(u => u.userId === userId);
    if (user) user.unreadCount = 0;
    this.chatList$.next([...list]);
  }

  public scrollToBottom = new BehaviorSubject<boolean>(false);
}

===== FILE: src\app\services\shop\countType\count-type.service.spec.ts =====
import { TestBed } from '@angular/core/testing';

import { CountTypeService } from './count-type.service';

describe('CountTypeService', () => {
  let service: CountTypeService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(CountTypeService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


===== FILE: src\app\services\shop\countType\count-type.service.ts =====
// Angular Imports
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';

// Shared & Utility Imports
import { ToastService } from '../../utilities/toast.service';
import { BaseService } from '../../utilities/base.service';
import { Domain } from 'src/utilities/path';

// DTO Imports
import { CountTypeDto } from './../../../dto/shop/CountTypeDto';


// RxJS Imports
import { catchError, Observable, throwError } from 'rxjs';


// ==========================================================================
// â¬‡ï¸ Service Definition: CountTypeService
// ==========================================================================
@Injectable({
  providedIn: 'root'
})
export class CountTypeService extends BaseService<CountTypeDto , CountTypeDto> {
protected  endpoint= '/api/counttype';

}


===== FILE: src\app\services\shop\inventory\inventory.service.spec.ts =====
import { TestBed } from '@angular/core/testing';

import { InventoryService } from './inventory.service';

describe('InventoryService', () => {
  let service: InventoryService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(InventoryService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


===== FILE: src\app\services\shop\inventory\inventory.service.ts =====
import { Injectable } from '@angular/core';
import { BaseService } from '../../utilities/base.service';
import {InventoryDto} from 'src/app/dto/shop/InventoryDto'

@Injectable({
  providedIn: 'root'
})
export class InventoryService extends BaseService<InventoryDto , InventoryDto> {

  protected endpoint='/api/inv';
   

}


===== FILE: src\app\services\shop\product\product.service.spec.ts =====
import { TestBed } from '@angular/core/testing';

import { ProductService } from '../product/product.service';

describe('ProductService', () => {
  let service: ProductService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(ProductService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


===== FILE: src\app\services\shop\product\product.service.ts =====
import { ToastService } from '../../utilities/toast.service';
import { ListRequest } from '../../../dto/ListRequestDto';
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Domain } from '../../../../utilities/path';
import { Injectable } from '@angular/core';
import { catchError, map, Observable, throwError } from 'rxjs';
import { ProductCreateDto, ProductViewDto } from '../../../dto/shop/ProductDto';
import { BaseService } from '../../utilities/base.service';
import { ApiResult } from 'src/app/dto/api-result';

@Injectable({
  providedIn: 'root'
})
export class ProductService extends BaseService<ProductViewDto, ProductCreateDto> {
  protected endpoint='/api/product';
  private apiurl = Domain;







 

  /** Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø­ØµÙˆÙ„ Ø¨Ø§ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ */
  searchProducts(request: ListRequest): Observable<ApiResult<ProductViewDto[]>> {


    return this.http.post<ApiResult<ProductViewDto[]>>(`${this.apiurl}/api/product/search`, request, { headers: this.getJsonHeaders() }).pipe(
      catchError(error => {
        //this.toast.showToast.error({ message: 'Ø®Ø·Ø§ Ø¯Ø± ØªØ±Ø§Ú©Ù†Ø´ ' });
        this.toast.error("need change");
        return throwError(() => error);
      })
    );
  }

}


===== FILE: src\app\services\utilities\base.service.spec.ts =====
// src/app/services/utilities/mock-base.service.ts
import { Injectable } from '@angular/core';
import { BaseService } from './base.service';

@Injectable()
export class MockBaseService extends BaseService<any, any> {
  protected endpoint = '/api/test'; // ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù…Ù¾Ø§ÛŒÙ„ Ø´Ø¯Ù†

  constructor() {
    super(null!, null!); // HttpClient Ùˆ ToastService Ø±Ùˆ null Ù…ÛŒâ€ŒØ°Ø§Ø±ÛŒÙ… Ú†ÙˆÙ† ØªØ³Øª ÙˆØ§Ø­Ø¯ Ù‡Ø³Øª
  }
}

===== FILE: src\app\services\utilities\base.service.ts =====
// src/app/services/utilities/base.service.ts

import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { Observable, throwError } from 'rxjs';
import { catchError } from 'rxjs/operators';
import { ToastService } from './toast.service';
import { ApiResult } from '../../dto/api-result';
import { ListRequest } from '../../dto/ListRequestDto';
import { Domain } from '../../../utilities/path';

@Injectable({ providedIn: 'root' })
export abstract class BaseService<TViewDto, TCreateDto = TViewDto> {
  protected apiUrl = Domain;
  protected abstract endpoint: string;

  constructor(
    protected http: HttpClient,
    protected toast: ToastService
  ) {}

  protected getJsonHeaders(): HttpHeaders {
    return new HttpHeaders({
      accept: 'application/json',
      'Content-Type': 'application/json',
    });
  }

  // Ù„ÛŒØ³Øª: Ù‡Ù…ÛŒØ´Ù‡ TViewDto[]
  getRecords(request: ListRequest): Observable<ApiResult<TViewDto[]>> {
    return this.http
      .post<ApiResult<TViewDto[]>>(
        `${this.apiUrl}${this.endpoint}/GetAll`,
        request,
        { headers: this.getJsonHeaders() }
      )
      .pipe(catchError(err => this.handleError(err)));
  }



    // Ù„ÛŒØ³Øª: Ù‡Ù…ÛŒØ´Ù‡ TViewDto[]
    getRecordList(): Observable<ApiResult<TViewDto[]>> {
      return this.http
        .get<ApiResult<TViewDto[]>>(
          `${this.apiUrl}${this.endpoint}/GetList`,
          
          { headers: this.getJsonHeaders() }
        )
        .pipe(catchError(err => this.handleError(err)));
    }
  
  // Ø§ÛŒØ¬Ø§Ø¯
  insertRecord(data: TCreateDto): Observable<ApiResult<TCreateDto>> {
    return this.http
      .post<ApiResult<TCreateDto>>(
        `${this.apiUrl}${this.endpoint}/create`,
        data,
        { headers: this.getJsonHeaders() }
      )
      .pipe(catchError(err => this.handleError(err)));
  }

  // ÙˆÛŒØ±Ø§ÛŒØ´
  updateRecord(data: TCreateDto): Observable<ApiResult<TCreateDto>> {
    return this.http
      .post<ApiResult<TCreateDto>>(
        `${this.apiUrl}${this.endpoint}/update`,
        data,
        { headers: this.getJsonHeaders() }
      )
      .pipe(catchError(err => this.handleError(err)));
  }

  // Ø­Ø°Ù Ú†Ù†Ø¯ØªØ§ÛŒÛŒ
  deleteRecords(ids: number[]): Observable<ApiResult<any>> {
    return this.http
      .post<ApiResult<any>>(
        `${this.apiUrl}${this.endpoint}/delete`,
        ids,
        { headers: this.getJsonHeaders() }
      )
      .pipe(catchError(err => this.handleError(err)));
  }

  // Ø¯Ø±ÛŒØ§ÙØª ÛŒÚ© Ø±Ú©ÙˆØ±Ø¯
  getRecordById(id: number): Observable<ApiResult<TCreateDto>> {
    return this.http
      .get<ApiResult<TCreateDto>>(
        `${this.apiUrl}${this.endpoint}/getById/?id=${id}`,
        { headers: this.getJsonHeaders() }
      )
      .pipe(catchError(err => this.handleError(err)));
  }

  // ÙØ±Ù… Ø§ÛŒØ¬Ø§Ø¯ (Ù…Ø«Ù„ roles, permissions)
  getCreateForm<U = any>(): Observable<ApiResult<U>> {
    return this.http
      .get<ApiResult<U>>(
        `${this.apiUrl}${this.endpoint}/getcreateform`,
        { headers: this.getJsonHeaders() }
      )
      .pipe(catchError(err => this.handleError(err)));
  }

  // --- Ø®Ø·Ø§ ---
  protected handleError(error: any): Observable<never> {
    // Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø§ÛŒÙ†Ø¬Ø§ Ù„Ø§Ú¯ Ø¨Ø²Ù†ÛŒ
    console.error('API Error:', error);
    return throwError(() => error);
  }

  // --- Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… ---
  protected showApiResultToast(result: ApiResult<any>): void {
    if (!result) return;

    if (result.isSucceeded) {
      if (result.message) {
        this.toast.success(result.message);
      }
    } else {
      const errorMsg = result.errors?.[0] ?? result.message ?? 'Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯';
      this.toast.error(errorMsg);
    }
  }
}


===== FILE: src\app\layout\default-layout\default-header\default-header.component.ts =====
import { NgTemplateOutlet } from '@angular/common';
import { Component, computed, inject, input } from '@angular/core';
import { RouterLink, RouterLinkActive } from '@angular/router';
import { Router } from '@angular/router';
import {
  AvatarComponent,
  BadgeComponent,
  BreadcrumbRouterComponent,
  ColorModeService,
  ContainerComponent,
  DropdownComponent,
  DropdownDividerDirective,
  DropdownHeaderDirective,
  DropdownItemDirective,
  DropdownMenuDirective,
  DropdownToggleDirective,
  HeaderComponent,
  HeaderNavComponent,
  HeaderTogglerDirective,
  NavItemComponent,
  NavLinkDirective,
  SidebarToggleDirective
} from '@coreui/angular';

import { IconDirective } from '@coreui/icons-angular';

@Component({
    selector: 'app-default-header',
    templateUrl: './default-header.component.html',
  imports: [ContainerComponent, HeaderTogglerDirective, SidebarToggleDirective, IconDirective, HeaderNavComponent, NavItemComponent, NavLinkDirective, RouterLink, RouterLinkActive, NgTemplateOutlet, BreadcrumbRouterComponent, DropdownComponent, DropdownToggleDirective, AvatarComponent, DropdownMenuDirective, DropdownHeaderDirective, DropdownItemDirective, BadgeComponent, DropdownDividerDirective]
})
export class DefaultHeaderComponent extends HeaderComponent {

  readonly #colorModeService = inject(ColorModeService);
  readonly colorMode = this.#colorModeService.colorMode;

  readonly colorModes = [
    { name: 'light', text: 'Light', icon: 'cilSun' },
    { name: 'dark', text: 'Dark', icon: 'cilMoon' },
    { name: 'auto', text: 'Auto', icon: 'cilContrast' }
  ];

  readonly icons = computed(() => {
    const currentMode = this.colorMode();
    return this.colorModes.find(mode => mode.name === currentMode)?.icon ?? 'cilSun';
  });

  constructor() {
    super();
  }

  sidebarId = input('sidebar1');

  public newMessages = [
    {
      id: 0,
      from: 'Jessica Williams',
      avatar: '7.jpg',
      status: 'success',
      title: 'Urgent: System Maintenance Tonight',
      time: 'Just now',
      link: 'apps/email/inbox/message',
      message: 'Attention team, we\'ll be conducting critical system maintenance tonight from 10 PM to 2 AM. Plan accordingly...'
    },
    {
      id: 1,
      from: 'Richard Johnson',
      avatar: '6.jpg',
      status: 'warning',
      title: 'Project Update: Milestone Achieved',
      time: '5 minutes ago',
      link: 'apps/email/inbox/message',
      message: 'Kudos on hitting sales targets last quarter! Let\'s keep the momentum. New goals, new victories ahead...'
    },
    {
      id: 2,
      from: 'Angela Rodriguez',
      avatar: '5.jpg',
      status: 'danger',
      title: 'Social Media Campaign Launch',
      time: '1:52 PM',
      link: 'apps/email/inbox/message',
      message: 'Exciting news! Our new social media campaign goes live tomorrow. Brace yourselves for engagement...'
    },
    {
      id: 3,
      from: 'Jane Lewis',
      avatar: '4.jpg',
      status: 'info',
      title: 'Inventory Checkpoint',
      time: '4:03 AM',
      link: 'apps/email/inbox/message',
      message: 'Team, it\'s time for our monthly inventory check. Accurate counts ensure smooth operations. Let\'s nail it...'
    },
    {
      id: 3,
      from: 'Ryan Miller',
      avatar: '4.jpg',
      status: 'info',
      title: 'Customer Feedback Results',
      time: '3 days ago',
      link: 'apps/email/inbox/message',
      message: 'Our latest customer feedback is in. Let\'s analyze and discuss improvements for an even better service...'
    }
  ];

  public newNotifications = [
    { id: 0, title: 'New user registered', icon: 'cilUserFollow', color: 'success' },
    { id: 1, title: 'User deleted', icon: 'cilUserUnfollow', color: 'danger' },
    { id: 2, title: 'Sales report is ready', icon: 'cilChartPie', color: 'info' },
    { id: 3, title: 'New client', icon: 'cilBasket', color: 'primary' },
    { id: 4, title: 'Server overloaded', icon: 'cilSpeedometer', color: 'warning' }
  ];

  public newStatus = [
    { id: 0, title: 'CPU Usage', value: 25, color: 'info', details: '348 Processes. 1/4 Cores.' },
    { id: 1, title: 'Memory Usage', value: 70, color: 'warning', details: '11444GB/16384MB' },
    { id: 2, title: 'SSD 1 Usage', value: 90, color: 'danger', details: '243GB/256GB' }
  ];

  public newTasks = [
    { id: 0, title: 'Upgrade NPM', value: 0, color: 'info' },
    { id: 1, title: 'ReactJS Version', value: 25, color: 'danger' },
    { id: 2, title: 'VueJS Version', value: 50, color: 'warning' },
    { id: 3, title: 'Add new layouts', value: 75, color: 'info' },
    { id: 4, title: 'Angular Version', value: 100, color: 'success' }
  ];




  // added by  hirash


    private router = inject(Router);

  // ...

  logout(event: Event) {
  event.preventDefault(); 
  localStorage.removeItem('token');
  localStorage.removeItem('user');
  this.router.navigate(['/login']);
}
}


===== FILE: src\app\layout\default-layout\default-layout.component.html =====
<!--sidebar-->
<c-sidebar
  #sidebar1="cSidebar"
  class="d-print-none sidebar sidebar-fixed border-end"
  colorScheme="dark"
  id="sidebar1"
  visible
>
  <c-sidebar-header class="border-bottom">
    <c-sidebar-brand [routerLink]="[]">
      <svg [class]="{icon: false}" cIcon class="sidebar-brand-full" height="32" name="logo" title="CoreUI Logo"></svg>
      <svg cIcon class="sidebar-brand-narrow" height="32" name="signet" title="CoreUI Logo"></svg>
    </c-sidebar-brand>
  </c-sidebar-header>

  <ng-scrollbar pointerEventsMethod="scrollbar" visibility="hover">
    <c-sidebar-nav [navItems]="navItems" dropdownMode="close" compact />
  </ng-scrollbar>

  @if (!sidebar1.narrow) {
    <c-sidebar-footer cSidebarToggle="sidebar1" class="border-top d-none d-lg-flex" toggle="unfoldable" style="cursor: pointer;">
      <button cSidebarToggler aria-label="Toggle sidebar fold"></button>
    </c-sidebar-footer>
  }
</c-sidebar>

<!--main-->
<div class="wrapper d-flex flex-column min-vh-100">
  <!--app-header-->

  <app-default-header
    [cShadowOnScroll]="'sm'"
    class="mb-4 d-print-none header header-sticky p-0 shadow-sm"
    position="sticky"
    sidebarId="sidebar1"
  />

  <!--app-body-->
  <div class="body flex-grow-1">
    <c-container breakpoint="lg" class="h-auto px-4">
    <!-- <app-toast-container />--> 

      <router-outlet />


    </c-container>
  </div>
  <!--app footer-->
  <app-default-footer />


</div>


===== FILE: src\app\layout\default-layout\default-layout.component.scss =====
:host::ng-deep {
  .ng-scrollbar {
    --scrollbar-padding: 1px;
    --scrollbar-size: 5px;
    --scrollbar-thumb-color: var(--cui-gray-500, #aab3c5);
    --scrollbar-thumb-hover-color: var(--cui-gray-400, #cfd4de);
    --scrollbar-hover-size: calc(var(--scrollbar-size) * 1.5);
    --scrollbar-border-radius: 5px;
  }

  .ng-scroll-content {
    display: flex;
    min-height: 100%;
  }

  //.sidebar-nav {
  //  scrollbar-color: var(--cui-gray-500, #444) transparent;
  //}
}

// ng-scrollbar css variables
//.cui-scrollbar {
//  --scrollbar-border-radius: 7px;
//  --scrollbar-padding: 1px;
//  --scrollbar-viewport-margin: 0;
//  --scrollbar-track-color: transparent;
//  --scrollbar-wrapper-color: transparent;
//  --scrollbar-thumb-color: rgba(0, 0, 0, 0.2);
//  --scrollbar-thumb-hover-color: var(--scrollbar-thumb-color);
//  --scrollbar-size: 5px;
//  --scrollbar-hover-size: var(--scrollbar-size);
//  --scrollbar-thumb-transition: height ease-out 150ms, width ease-out 150ms;
//  --scrollbar-track-transition: height ease-out 150ms, width ease-out 150ms;
//}


===== FILE: src\app\layout\default-layout\default-layout.component.ts =====

import {  Component, inject } from '@angular/core';
import { RouterLink, RouterOutlet } from '@angular/router';
import { NgScrollbar } from 'ngx-scrollbar';
import {ToastContainerComponent} from './../../views/utilities/toast-container/toast-container.component'
import { IconDirective } from '@coreui/icons-angular';
import { NavigationService } from './_nav';
import {
  ContainerComponent,
  ShadowOnScrollDirective,
  SidebarBrandComponent,
  SidebarComponent,
  SidebarFooterComponent,
  SidebarHeaderComponent,
  SidebarNavComponent,
  SidebarToggleDirective,
  SidebarTogglerDirective,
  ToasterComponent
} from '@coreui/angular';

import { DefaultFooterComponent, DefaultHeaderComponent } from './';




function isOverflown(element: HTMLElement) {
  return (
    element.scrollHeight > element.clientHeight ||
    element.scrollWidth > element.clientWidth
  );
}

@Component({
  selector: 'app-dashboard',
  templateUrl: './default-layout.component.html',
  styleUrls: ['./default-layout.component.scss'],
  imports: [
    SidebarComponent,
    SidebarHeaderComponent,
    SidebarBrandComponent,
    SidebarNavComponent,
    SidebarFooterComponent,
    SidebarToggleDirective,
    SidebarTogglerDirective,
    ContainerComponent,
    DefaultFooterComponent,
    DefaultHeaderComponent,
    IconDirective,
    NgScrollbar,
    RouterOutlet,
    RouterLink,
    ShadowOnScrollDirective,
    ToastContainerComponent
  ]
})
export class DefaultLayoutComponent   {

  private navService = inject(NavigationService);
  get navItems() {
    return this.navService.getNavItems();
  }


}


===== FILE: src\app\layout\default-layout\index.ts =====
export * from './default-footer/default-footer.component';
export * from './default-header/default-header.component';
export * from './default-layout.component';


===== FILE: src\app\layout\default-layout\_nav.ts =====
export { NavigationService } from 'src/app/services/base/navigation/navigation.service';

===== FILE: src\app\layout\index.ts =====
export * from './default-layout';


===== FILE: src\app\pipes\filter.pipe.spec.ts =====
import { FilterPipe } from './filter.pipe';

describe('FilterPipe', () => {
  it('create an instance', () => {
    const pipe = new FilterPipe();
    expect(pipe).toBeTruthy();
  });
});


===== FILE: src\app\pipes\filter.pipe.ts =====
// src/app/pipes/filter.pipe.ts
import { Pipe, PipeTransform } from '@angular/core';

@Pipe({ name: 'filter', standalone: true })
export class FilterPipe implements PipeTransform {
  transform(items: any[], term: string, field: string): any[] {
    if (!items || !term) return items;
    const lower = term.toLowerCase();
    return items.filter(item => 
      (item[field] || '').toString().toLowerCase().includes(lower)
    );
  }
}

===== FILE: src\app\services\auth\login\auth.guard.ts =====
import { inject } from '@angular/core';
import { CanActivateFn, Router } from '@angular/router';

export const authGuard: CanActivateFn = (route, state) => {
  const router = inject(Router);

  // ðŸ‘‡ Ø¨Ø±Ø±Ø³ÛŒ Ù„Ø§Ú¯ÛŒÙ† Ø¨ÙˆØ¯Ù†
  const isLoggedIn = !!localStorage.getItem('token'); // ÛŒØ§ Ù‡Ø± Ù†Ø´Ø§Ù†Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ú©Ø±Ø¯ÛŒ

  if (!isLoggedIn) {
    // Ø§Ú¯Ø± Ù„Ø§Ú¯ÛŒÙ† Ù†ÛŒØ³ØªØŒ Ø¨Ø±Ù‡ Ø¨Ù‡ ØµÙØ­Ù‡ login
    router.navigate(['/login']); // Ù…Ø³ÛŒØ± Ù„Ø§Ú¯ÛŒÙ† Ù¾Ø±ÙˆÚ˜Ù‡â€ŒØª
    return false;
  }

  return true;
};


===== FILE: src\app\services\auth\login\auth.service.spec.ts =====
import { TestBed } from '@angular/core/testing';

import { AuthService } from './auth.service';

describe('AuthService', () => {
  let service: AuthService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(AuthService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


===== FILE: src\app\services\auth\login\auth.service.ts =====
// src/app/services/auth/login/auth.service.ts
import { Injectable } from '@angular/core';
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Observable, BehaviorSubject, throwError, of } from 'rxjs';
import { catchError, map, tap } from 'rxjs/operators';
import { ToastService } from '../../utilities/toast.service';
import { Domain } from '../../../../utilities/path';
import { ApiResult } from 'src/app/dto/api-result';

@Injectable({
  providedIn: 'root'
})
export class AuthService {
  private apiUrl = `${Domain}/api/Auth`;

  // Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø±Ù…ÛŒØ´Ù†â€ŒÙ‡Ø§
  private permissions = new BehaviorSubject<string[]>([]);
  public readonly permissions$ = this.permissions.asObservable();

  constructor(private http: HttpClient, private toast: ToastService) {
    this.loadPermissionsFromStorage();
  }

  private loadPermissionsFromStorage(): void {
    const stored = localStorage.getItem('permissions');
    if (stored) {
      this.permissions.next(JSON.parse(stored)); // Ø§ÛŒÙ†Ø¬Ø§ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯: Ø¯Ø§Ø®Ù„ Ø¨Ù„Ø§Ú© if
    }
  }

// src/app/services/auth/login/auth.service.ts

login(username: string, password: string): Observable<any> {
  const body = { username, password };

  return this.http.post<ApiResult<any>>(`${this.apiUrl}/login`, body).pipe(
    map(response => {
      if (response.isSucceeded && response.data?.token) {
        const token = response.data.token;
        const user = response.data;

        // Ø²Ù…Ø§Ù† Ø§Ù†Ù‚Ø¶Ø§: Û²Û´ Ø³Ø§Ø¹Øª Ø§Ø² Ø§Ù„Ø§Ù†
        const expiresAt = Date.now() + 24 * 60 * 60 * 1000; // 24 Ø³Ø§Ø¹Øª Ø¨Ù‡ Ù…ÛŒÙ„ÛŒâ€ŒØ«Ø§Ù†ÛŒÙ‡

        // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
        localStorage.setItem('token', token);
        localStorage.setItem('user', JSON.stringify(user));
        localStorage.setItem('token_expires_at', expiresAt.toString());

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ permissions
        this.fetchPermissions();
      }
      return response;
    }),
    tap(() => this.fetchPermissions()),
    catchError(error => {
      this.toast.error('Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…');
      return throwError(() => error);
    })
  );
}

getUserId(): number {
  const user = localStorage.getItem('user');
  if (!user) return 0;

  try {
    const parsed = JSON.parse(user);
    // Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ø³Ø§Ø®ØªØ§Ø±Ù‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
    return parsed.data?.userId || parsed.userId || parsed.id || 0;
  } catch {
    return 0;
  }
}

  private fetchPermissions(): void {
    this.http.get<ApiResult<string[]>>(`/api/user/permissions`).pipe(
      catchError(() => {
        this.toast.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§');
        return of(null);
      })
    ).subscribe(res => {
      if (res?.isSucceeded && res.data) {
        this.permissions.next(res.data);
        localStorage.setItem('permissions', JSON.stringify(res.data));
      }
    });
  }

  hasPermission(permission: string): boolean {
    return this.permissions.value.includes(permission);
  }

  logout(): void {
    localStorage.removeItem('token');
    localStorage.removeItem('user');
    localStorage.removeItem('permissions');
    this.permissions.next([]);
  }

  isLoggedIn(): boolean {
    return !!localStorage.getItem('token');
  }

  getToken(): string | null {
    return localStorage.getItem('token');
  }

  // Ù…ØªØ¯ Ø¨Ø±Ø§ÛŒ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø³ØªÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
  refreshPermissions(): void {
    this.fetchPermissions();
  }
}

===== FILE: src\app\services\base\navigation\navigation.service.spec.ts =====
import { TestBed } from '@angular/core/testing';

import { NavigationService } from './navigation.service';

describe('NavigationService', () => {
  let service: NavigationService;

  beforeEach(() => {
    TestBed.configureTestingModule({});
    service = TestBed.inject(NavigationService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });
});


